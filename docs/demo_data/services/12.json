{
    "id": 12,
    "name": "service-media",
    "git_repo_url": "/home/evan/Code/rinder/services/media",
    "entrypoint_path": "cmd/main.go",
    "entrypoint_function": "main",
    "git_org_url": "github.com/rinder",
    "git_commit": null,
    "created_at": "2026-01-21T10:23:37.3516147Z",
    "updated_at": "2026-01-21T10:23:38.920708626Z",
    "status": "analyzing-completed",
    "handlers": [
        {
            "id": 263,
            "type": "http",
            "method": "ANY",
            "path": "/health",
            "source_function_name": "RegisterRoutes",
            "function_name": "healthCheck",
            "source_function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:27:19",
            "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:38:19",
            "outputs": [
                {
                    "id": 1595,
                    "handler_id": 263,
                    "type": "http_response",
                    "label": "HTTP 200 JSON response",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:38:19",
                    "function_name": "healthCheck",
                    "description": "The handler returns an HTTP 200 response with Content-Type 'application/json' and body '{\"success\":true,\"data\":{\"status\":\"healthy\",\"service\":\"media\"}}'.",
                    "created_at": "2026-01-30T10:25:33.644234796Z",
                    "updated_at": null
                }
            ],
            "created_at": "2026-01-30T10:25:14.928088789Z",
            "updated_at": null
        },
        {
            "id": 269,
            "type": "http",
            "method": "DELETE",
            "path": "/api/v1/media/",
            "source_function_name": "RegisterRoutes",
            "function_name": "handleMediaByID",
            "source_function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:27:19",
            "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:106:19",
            "outputs": [
                {
                    "id": 1794,
                    "handler_id": 269,
                    "type": "database",
                    "label": "BEGIN TRANSACTION (BeginTx) for SetPrimary",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/repository/media_repository.go:165:27",
                    "function_name": "SetPrimary",
                    "description": "Start a database transaction before unsetting and setting primary flags for media (part of SetPrimary).",
                    "created_at": "2026-01-30T10:26:29.779348468Z",
                    "updated_at": null
                },
                {
                    "id": 1797,
                    "handler_id": 269,
                    "type": "database",
                    "label": "COMMIT TRANSACTION (tx.Commit) for SetPrimary",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/repository/media_repository.go:165:27",
                    "function_name": "SetPrimary",
                    "description": "Commit the transaction after updating primary flags (SetPrimary completes with a commit).",
                    "created_at": "2026-01-30T10:26:29.782276762Z",
                    "updated_at": null
                },
                {
                    "id": 1792,
                    "handler_id": 269,
                    "type": "database",
                    "label": "DELETE FROM media WHERE id = $1",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/repository/media_repository.go:150:27",
                    "function_name": "Delete",
                    "description": "Delete the media record from the database for the given media ID.",
                    "created_at": "2026-01-30T10:26:29.776062909Z",
                    "updated_at": null
                },
                {
                    "id": 1779,
                    "handler_id": 269,
                    "type": "database",
                    "label": "SELECT FROM media WHERE id = $1",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/repository/media_repository.go:86:27",
                    "function_name": "GetByID",
                    "description": "Retrieve a media record by ID from the database (used by GET /api/v1/media/{id} and by DELETE to fetch the media to be deleted).",
                    "created_at": "2026-01-30T10:26:29.761844593Z",
                    "updated_at": null
                },
                {
                    "id": 1793,
                    "handler_id": 269,
                    "type": "database",
                    "label": "SELECT FROM media WHERE profile_id = $1 ORDER BY sort_order ASC",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/repository/media_repository.go:114:27",
                    "function_name": "GetByProfileID",
                    "description": "When a primary media item is deleted, retrieve the list of media for that profile to choose a new primary.",
                    "created_at": "2026-01-30T10:26:29.778292329Z",
                    "updated_at": null
                },
                {
                    "id": 1795,
                    "handler_id": 269,
                    "type": "database",
                    "label": "UPDATE media SET is_primary = FALSE, updated_at = NOW() WHERE profile_id = $1",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/repository/media_repository.go:165:27",
                    "function_name": "SetPrimary",
                    "description": "Unset all primary flags for the profile as the first step in SetPrimary.",
                    "created_at": "2026-01-30T10:26:29.780342912Z",
                    "updated_at": null
                },
                {
                    "id": 1796,
                    "handler_id": 269,
                    "type": "database",
                    "label": "UPDATE media SET is_primary = TRUE, updated_at = NOW() WHERE id = $1 AND profile_id = $2",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/repository/media_repository.go:165:27",
                    "function_name": "SetPrimary",
                    "description": "Set the chosen media record as the new primary within the same transaction (SetPrimary).",
                    "created_at": "2026-01-30T10:26:29.781368081Z",
                    "updated_at": null
                },
                {
                    "id": 1798,
                    "handler_id": 269,
                    "type": "event",
                    "label": "Publish media.deleted event to Kafka (PublishWithKey)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/service/media_service.go:344:24",
                    "function_name": "publishMediaDeletedEvent",
                    "description": "After successful deletion (and any primacy adjustments), the service publishes a media.deleted event to Kafka with the media ID as key.",
                    "created_at": "2026-01-30T10:26:29.783170637Z",
                    "updated_at": null
                },
                {
                    "id": 1791,
                    "handler_id": 269,
                    "type": "http",
                    "label": "DELETE object from object storage (Minio RemoveObject)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/storage/minio.go:112:24",
                    "function_name": "Delete",
                    "description": "If the media URL contains an object name, the storage client attempts to delete the object from Minio (s.client.RemoveObject). This network call removes the stored file.",
                    "created_at": "2026-01-30T10:26:29.773370631Z",
                    "updated_at": null
                },
                {
                    "id": 1787,
                    "handler_id": 269,
                    "type": "http",
                    "label": "HTTP GET to profile service: GET /api/v1/profiles/{profileID}",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/service/media_service.go:295:24",
                    "function_name": "getProfileInfo",
                    "description": "To verify profile ownership before deleting media, the service issues an HTTP GET request to the profiles service endpoint for the media's profile.",
                    "created_at": "2026-01-30T10:26:29.769233491Z",
                    "updated_at": null
                },
                {
                    "id": 1781,
                    "handler_id": 269,
                    "type": "http_response",
                    "label": "HTTP 200 response (response.OK) with media payload",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:132:19",
                    "function_name": "getMedia",
                    "description": "For a successful GET, the media record is returned to the client (response.OK writes the HTTP success response).",
                    "created_at": "2026-01-30T10:26:29.76355936Z",
                    "updated_at": null
                },
                {
                    "id": 1799,
                    "handler_id": 269,
                    "type": "http_response",
                    "label": "HTTP 204 No Content response (response.NoContent)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:143:19",
                    "function_name": "deleteMedia",
                    "description": "After a successful DELETE operation, the handler returns an HTTP 204 No Content response to the client.",
                    "created_at": "2026-01-30T10:26:29.784225579Z",
                    "updated_at": null
                },
                {
                    "id": 1775,
                    "handler_id": 269,
                    "type": "http_response",
                    "label": "HTTP 400 Bad Request response (media ID is required)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:106:19",
                    "function_name": "handleMediaByID",
                    "description": "If the media ID is missing from the request path, an HTTP 400 error response is returned to the client via response.Error.",
                    "created_at": "2026-01-30T10:26:29.744340055Z",
                    "updated_at": null
                },
                {
                    "id": 1777,
                    "handler_id": 269,
                    "type": "http_response",
                    "label": "HTTP 400 Bad Request response (method not allowed)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:106:19",
                    "function_name": "handleMediaByID",
                    "description": "If the HTTP method is not GET or DELETE, an HTTP 400 error response is returned to the client via response.Error.",
                    "created_at": "2026-01-30T10:26:29.759539651Z",
                    "updated_at": null
                },
                {
                    "id": 1785,
                    "handler_id": 269,
                    "type": "http_response",
                    "label": "HTTP 401 Unauthorized response",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:143:19",
                    "function_name": "deleteMedia",
                    "description": "If the X-User-ID header is missing for a DELETE request, an HTTP 401 Unauthorized response is returned to the client via response.Error.",
                    "created_at": "2026-01-30T10:26:29.76732628Z",
                    "updated_at": null
                },
                {
                    "id": 1783,
                    "handler_id": 269,
                    "type": "http_response",
                    "label": "HTTP error response (response.Error) for Get failure",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:132:19",
                    "function_name": "getMedia",
                    "description": "If the service/repository returns an error while handling GET, an HTTP error response is returned to the client via response.Error.",
                    "created_at": "2026-01-30T10:26:29.765263253Z",
                    "updated_at": null
                },
                {
                    "id": 1789,
                    "handler_id": 269,
                    "type": "http_response",
                    "label": "HTTP error response (response.Error) for delete failure (forbidden/not found/etc.)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:143:19",
                    "function_name": "deleteMedia",
                    "description": "If the Delete service returns an error (e.g. profile not found, forbidden, or other errors), the handler returns an HTTP error response to the client via response.Error.",
                    "created_at": "2026-01-30T10:26:29.771264901Z",
                    "updated_at": null
                }
            ],
            "created_at": "2026-01-30T10:25:14.951515389Z",
            "updated_at": null
        },
        {
            "id": 267,
            "type": "http",
            "method": "GET",
            "path": "/api/v1/media/",
            "source_function_name": "RegisterRoutes",
            "function_name": "handleMediaByID",
            "source_function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:27:19",
            "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:106:19",
            "outputs": [],
            "created_at": "2026-01-30T10:25:14.948553933Z",
            "updated_at": null
        },
        {
            "id": 271,
            "type": "http",
            "method": "GET",
            "path": "/api/v1/media/profile/",
            "source_function_name": "RegisterRoutes",
            "function_name": "handleMediaByProfile",
            "source_function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:27:19",
            "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:159:19",
            "outputs": [
                {
                    "id": 1622,
                    "handler_id": 271,
                    "type": "database",
                    "label": "SELECT id, profile_id, user_id, type, filename, content_type, size, url, thumbnail_url, is_primary, sort_order, created_at, updated_at FROM media WHERE profile_id = $1 ORDER BY sort_order ASC",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/repository/media_repository.go:114:27",
                    "function_name": "GetByProfileID",
                    "description": "The repository executes a SQL query against the configured database to fetch all media rows for the given profile_id (QueryContext). This is the database call that returns 0..N media rows.",
                    "created_at": "2026-01-30T10:25:58.834410606Z",
                    "updated_at": null
                },
                {
                    "id": 1624,
                    "handler_id": 271,
                    "type": "http_response",
                    "label": "HTTP 200 JSON response with media list (response.OK)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:159:19",
                    "function_name": "handleMediaByProfile",
                    "description": "On success, the handler returns an HTTP 200 response containing the media list as JSON. If the repository returned nil, an empty JSON array is returned instead of null.",
                    "created_at": "2026-01-30T10:25:58.837320459Z",
                    "updated_at": null
                },
                {
                    "id": 1620,
                    "handler_id": 271,
                    "type": "http_response",
                    "label": "HTTP 400 error response (method not allowed)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:159:19",
                    "function_name": "handleMediaByProfile",
                    "description": "If the incoming request method is not GET, the handler returns an HTTP error response (bad request / method not allowed) to the client via response.Error.",
                    "created_at": "2026-01-30T10:25:58.81850197Z",
                    "updated_at": null
                },
                {
                    "id": 1621,
                    "handler_id": 271,
                    "type": "http_response",
                    "label": "HTTP 400 error response (profile ID is required)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:159:19",
                    "function_name": "handleMediaByProfile",
                    "description": "If the profile ID cannot be extracted from the request path (empty), the handler returns an HTTP error response (bad request) to the client via response.Error.",
                    "created_at": "2026-01-30T10:25:58.832315319Z",
                    "updated_at": null
                },
                {
                    "id": 1623,
                    "handler_id": 271,
                    "type": "http_response",
                    "label": "HTTP error response (propagated from service/repository)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:159:19",
                    "function_name": "handleMediaByProfile",
                    "description": "If the mediaService or repository returns an error (for example a database query error), the handler returns an HTTP error response to the client via response.Error, propagating that error.",
                    "created_at": "2026-01-30T10:25:58.836088577Z",
                    "updated_at": null
                }
            ],
            "created_at": "2026-01-30T10:25:14.954628012Z",
            "updated_at": null
        },
        {
            "id": 265,
            "type": "http",
            "method": "POST",
            "path": "/api/v1/media",
            "source_function_name": "RegisterRoutes",
            "function_name": "handleMedia",
            "source_function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:27:19",
            "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:45:19",
            "outputs": [
                {
                    "id": 1759,
                    "handler_id": 265,
                    "type": "database",
                    "label": "INSERT INTO media (...) VALUES (...)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/repository/media_repository.go:53:27",
                    "function_name": "Create",
                    "description": "Create a new media row in the database (inserting id, profile_id, user_id, filename, content_type, size, url, is_primary, sort_order, timestamps, etc.).",
                    "created_at": "2026-01-30T10:26:25.354277955Z",
                    "updated_at": null
                },
                {
                    "id": 1758,
                    "handler_id": 265,
                    "type": "database",
                    "label": "SELECT COALESCE(MAX(sort_order), -1) FROM media WHERE profile_id = $1",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/repository/media_repository.go:53:27",
                    "function_name": "Create",
                    "description": "Query the current maximum sort_order for the profile to determine the new media sort_order.",
                    "created_at": "2026-01-30T10:26:25.352960425Z",
                    "updated_at": null
                },
                {
                    "id": 1756,
                    "handler_id": 265,
                    "type": "database",
                    "label": "SELECT COUNT(*) FROM media WHERE profile_id = $1",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/repository/media_repository.go:222:27",
                    "function_name": "CountByProfileID",
                    "description": "Count how many media rows exist for the profile to enforce per-profile photo limits.",
                    "created_at": "2026-01-30T10:26:25.350339448Z",
                    "updated_at": null
                },
                {
                    "id": 1760,
                    "handler_id": 265,
                    "type": "database",
                    "label": "UPDATE media SET is_primary = FALSE, updated_at = NOW() WHERE profile_id = $1",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/repository/media_repository.go:165:27",
                    "function_name": "SetPrimary",
                    "description": "When marking a media item as primary and there are existing photos, unset the is_primary flag on all other media for the profile (part of SetPrimary transaction).",
                    "created_at": "2026-01-30T10:26:25.355494629Z",
                    "updated_at": null
                },
                {
                    "id": 1761,
                    "handler_id": 265,
                    "type": "database",
                    "label": "UPDATE media SET is_primary = TRUE, updated_at = NOW() WHERE id = $1 AND profile_id = $2",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/repository/media_repository.go:165:27",
                    "function_name": "SetPrimary",
                    "description": "Set the newly uploaded media row as the primary photo for the profile (part of SetPrimary transaction).",
                    "created_at": "2026-01-30T10:26:25.357007801Z",
                    "updated_at": null
                },
                {
                    "id": 1762,
                    "handler_id": 265,
                    "type": "event",
                    "label": "Publish to Kafka topic (media.uploaded) with key = media.ID",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/service/media_service.go:327:24",
                    "function_name": "publishMediaUploadedEvent",
                    "description": "The service publishes a MediaUploaded event to the Kafka topic (topic: kafka.TopicMediaUploaded) containing media metadata (media ID, profile ID, user ID, type, URL, content type, size, timestamp).",
                    "created_at": "2026-01-30T10:26:25.358475303Z",
                    "updated_at": null
                },
                {
                    "id": 1755,
                    "handler_id": 265,
                    "type": "http",
                    "label": "GET /api/v1/profiles/{profile_id}",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/service/media_service.go:295:24",
                    "function_name": "getProfileInfo",
                    "description": "The media service calls the profile service to fetch profile info (to verify existence and ownership).",
                    "created_at": "2026-01-30T10:26:25.348920834Z",
                    "updated_at": null
                },
                {
                    "id": 1754,
                    "handler_id": 265,
                    "type": "http",
                    "label": "GET /api/v1/users/{user_id}",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/service/media_service.go:266:24",
                    "function_name": "getUserInfo",
                    "description": "The media service calls the user service to fetch/verify user info for the provided user ID.",
                    "created_at": "2026-01-30T10:26:25.347784709Z",
                    "updated_at": null
                },
                {
                    "id": 1757,
                    "handler_id": 265,
                    "type": "http",
                    "label": "PutObject to MinIO (upload object)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/storage/minio.go:93:24",
                    "function_name": "Upload",
                    "description": "The storage layer uploads the file stream to MinIO (PutObject), storing the file and returning a public URL.",
                    "created_at": "2026-01-30T10:26:25.351644752Z",
                    "updated_at": null
                },
                {
                    "id": 1764,
                    "handler_id": 265,
                    "type": "http",
                    "label": "RemoveObject from MinIO (delete object) â€” cleanup on DB create failure",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/storage/minio.go:112:24",
                    "function_name": "Delete",
                    "description": "If media record creation in the database fails after the file was uploaded, the service attempts to delete the uploaded object from MinIO (cleanup). This occurs conditionally when Create(...) returns an error.",
                    "created_at": "2026-01-30T10:26:25.362692892Z",
                    "updated_at": null
                },
                {
                    "id": 1763,
                    "handler_id": 265,
                    "type": "http_response",
                    "label": "HTTP 201 Created (media)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:55:19",
                    "function_name": "uploadMedia",
                    "description": "On successful upload and record creation, the handler returns an HTTP 201 Created response to the client with the media object.",
                    "created_at": "2026-01-30T10:26:25.360040604Z",
                    "updated_at": null
                },
                {
                    "id": 1751,
                    "handler_id": 265,
                    "type": "http_response",
                    "label": "HTTP 400 Bad Request (failed to parse multipart form)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:55:19",
                    "function_name": "uploadMedia",
                    "description": "If parsing the multipart form fails, the handler returns an HTTP Bad Request response to the client.",
                    "created_at": "2026-01-30T10:26:25.344498793Z",
                    "updated_at": null
                },
                {
                    "id": 1753,
                    "handler_id": 265,
                    "type": "http_response",
                    "label": "HTTP 400 Bad Request (file is required)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:55:19",
                    "function_name": "uploadMedia",
                    "description": "If the uploaded file part is missing or cannot be read, the handler returns an HTTP Bad Request response to the client.",
                    "created_at": "2026-01-30T10:26:25.346720919Z",
                    "updated_at": null
                },
                {
                    "id": 1749,
                    "handler_id": 265,
                    "type": "http_response",
                    "label": "HTTP 400 Bad Request (method not allowed)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:45:19",
                    "function_name": "handleMedia",
                    "description": "If the request method is not POST, the handler returns an HTTP error response (Bad Request / method not allowed) to the client.",
                    "created_at": "2026-01-30T10:26:25.340739584Z",
                    "updated_at": null
                },
                {
                    "id": 1752,
                    "handler_id": 265,
                    "type": "http_response",
                    "label": "HTTP 400 Bad Request (profile_id is required)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:55:19",
                    "function_name": "uploadMedia",
                    "description": "If the form value `profile_id` is missing, the handler returns an HTTP Bad Request response to the client.",
                    "created_at": "2026-01-30T10:26:25.345651473Z",
                    "updated_at": null
                },
                {
                    "id": 1750,
                    "handler_id": 265,
                    "type": "http_response",
                    "label": "HTTP 401 Unauthorized (missing X-User-ID)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:55:19",
                    "function_name": "uploadMedia",
                    "description": "If the X-User-ID header is missing from the request, the handler returns an HTTP Unauthorized response to the client.",
                    "created_at": "2026-01-30T10:26:25.342972872Z",
                    "updated_at": null
                },
                {
                    "id": 1765,
                    "handler_id": 265,
                    "type": "http_response",
                    "label": "HTTP error response forwarded to client when mediaService.Upload fails",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:55:19",
                    "function_name": "uploadMedia",
                    "description": "If mediaService.Upload returns an error (various possible HTTP-status-mapped errors such as 400/401/403/404/500), uploadMedia forwards an HTTP error response to the client. (The exact status depends on the error returned by the service.)",
                    "created_at": "2026-01-30T10:26:25.36519838Z",
                    "updated_at": null
                }
            ],
            "created_at": "2026-01-30T10:25:14.94197405Z",
            "updated_at": null
        },
        {
            "id": 273,
            "type": "http",
            "method": "POST",
            "path": "/api/v1/media/primary/",
            "source_function_name": "RegisterRoutes",
            "function_name": "handlePrimary",
            "source_function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:27:19",
            "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:188:19",
            "outputs": [
                {
                    "id": 1828,
                    "handler_id": 273,
                    "type": "database",
                    "label": "BEGIN TRANSACTION",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/repository/media_repository.go:165:27",
                    "function_name": "SetPrimary",
                    "description": "A database transaction is started before modifying media rows.",
                    "created_at": "2026-01-30T10:26:39.460931067Z",
                    "updated_at": null
                },
                {
                    "id": 1832,
                    "handler_id": 273,
                    "type": "database",
                    "label": "COMMIT TRANSACTION",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/repository/media_repository.go:165:27",
                    "function_name": "SetPrimary",
                    "description": "If updates succeed, the transaction is committed to persist the changes to the database.",
                    "created_at": "2026-01-30T10:26:39.467030937Z",
                    "updated_at": null
                },
                {
                    "id": 1831,
                    "handler_id": 273,
                    "type": "database",
                    "label": "ROLLBACK TRANSACTION (possible)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/repository/media_repository.go:165:27",
                    "function_name": "SetPrimary",
                    "description": "If an error occurs before commit, the deferred rollback will be executed on the transaction (possible DB rollback).",
                    "created_at": "2026-01-30T10:26:39.464848644Z",
                    "updated_at": null
                },
                {
                    "id": 1829,
                    "handler_id": 273,
                    "type": "database",
                    "label": "UPDATE media SET is_primary = FALSE, updated_at = NOW() WHERE profile_id = $1",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/repository/media_repository.go:165:27",
                    "function_name": "SetPrimary",
                    "description": "Within the transaction, all media rows for the profile have their is_primary flag unset.",
                    "created_at": "2026-01-30T10:26:39.462254885Z",
                    "updated_at": null
                },
                {
                    "id": 1830,
                    "handler_id": 273,
                    "type": "database",
                    "label": "UPDATE media SET is_primary = TRUE, updated_at = NOW() WHERE id = $1 AND profile_id = $2",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/repository/media_repository.go:165:27",
                    "function_name": "SetPrimary",
                    "description": "Within the transaction, the requested media row is updated to set is_primary = TRUE for the given media ID and profile ID.",
                    "created_at": "2026-01-30T10:26:39.463583126Z",
                    "updated_at": null
                },
                {
                    "id": 1825,
                    "handler_id": 273,
                    "type": "http",
                    "label": "HTTP GET /api/v1/profiles/{profileID}",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/service/media_service.go:295:24",
                    "function_name": "getProfileInfo",
                    "description": "The service calls the profile service to fetch profile info for the given profile ID via profileClient.Get.",
                    "created_at": "2026-01-30T10:26:39.456533039Z",
                    "updated_at": null
                },
                {
                    "id": 1834,
                    "handler_id": 273,
                    "type": "http_response",
                    "label": "HTTP 200 OK (primary photo updated)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:188:19",
                    "function_name": "handlePrimary",
                    "description": "On successful completion (profile verified and DB transaction committed), the handler returns an HTTP 200 JSON response with a success message to the client.",
                    "created_at": "2026-01-30T10:26:39.470121582Z",
                    "updated_at": null
                },
                {
                    "id": 1823,
                    "handler_id": 273,
                    "type": "http_response",
                    "label": "HTTP 400 Bad Request (invalid request body)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:188:19",
                    "function_name": "handlePrimary",
                    "description": "If the request body cannot be decoded as the expected JSON, the handler returns an HTTP 400 error response to the client.",
                    "created_at": "2026-01-30T10:26:39.452990464Z",
                    "updated_at": null
                },
                {
                    "id": 1824,
                    "handler_id": 273,
                    "type": "http_response",
                    "label": "HTTP 400 Bad Request (media_id is required)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:188:19",
                    "function_name": "handlePrimary",
                    "description": "If the decoded request is missing media_id, the handler returns an HTTP 400 error response to the client.",
                    "created_at": "2026-01-30T10:26:39.455068937Z",
                    "updated_at": null
                },
                {
                    "id": 1820,
                    "handler_id": 273,
                    "type": "http_response",
                    "label": "HTTP 400 Bad Request (method not allowed)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:188:19",
                    "function_name": "handlePrimary",
                    "description": "If the request method is not POST, the handler returns an HTTP 400 error response to the client.",
                    "created_at": "2026-01-30T10:26:39.434512382Z",
                    "updated_at": null
                },
                {
                    "id": 1822,
                    "handler_id": 273,
                    "type": "http_response",
                    "label": "HTTP 400 Bad Request (profile ID is required)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:188:19",
                    "function_name": "handlePrimary",
                    "description": "If the profile ID cannot be extracted from the request path, the handler returns an HTTP 400 error response to the client.",
                    "created_at": "2026-01-30T10:26:39.450836668Z",
                    "updated_at": null
                },
                {
                    "id": 1821,
                    "handler_id": 273,
                    "type": "http_response",
                    "label": "HTTP 401 Unauthorized (authentication required)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:188:19",
                    "function_name": "handlePrimary",
                    "description": "If the X-User-ID header is missing, the handler returns an HTTP 401 error response to the client.",
                    "created_at": "2026-01-30T10:26:39.446895428Z",
                    "updated_at": null
                },
                {
                    "id": 1827,
                    "handler_id": 273,
                    "type": "http_response",
                    "label": "HTTP 403 Forbidden (you do not own this profile)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:188:19",
                    "function_name": "handlePrimary",
                    "description": "If the profile's user ID does not match the request's user ID, the service returns a Forbidden error which the handler sends as an HTTP 403 response to the client.",
                    "created_at": "2026-01-30T10:26:39.459436736Z",
                    "updated_at": null
                },
                {
                    "id": 1833,
                    "handler_id": 273,
                    "type": "http_response",
                    "label": "HTTP 404 Not Found (media not found)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:188:19",
                    "function_name": "handlePrimary",
                    "description": "If the UPDATE that sets the new primary affects 0 rows, the repository returns NotFound and the handler sends an HTTP 404 response to the client.",
                    "created_at": "2026-01-30T10:26:39.468589112Z",
                    "updated_at": null
                },
                {
                    "id": 1826,
                    "handler_id": 273,
                    "type": "http_response",
                    "label": "HTTP 404 Not Found (profile not found)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:188:19",
                    "function_name": "handlePrimary",
                    "description": "If the profile service response is not successful, the service returns a NotFound error which the handler sends as an HTTP 404 response to the client.",
                    "created_at": "2026-01-30T10:26:39.457858428Z",
                    "updated_at": null
                },
                {
                    "id": 1835,
                    "handler_id": 273,
                    "type": "http_response",
                    "label": "HTTP 500 Internal Server Error (various internal failures)",
                    "function_id": "/home/evan/Code/rinder/services/media/internal/handler/handler.go:188:19",
                    "function_name": "handlePrimary",
                    "description": "Various internal failures (e.g., failing to start transaction, failing SQL execution, JSON decode errors from profile response decoding, or other wrapped internal errors) result in an error returned up to the handler which sends an HTTP 500 response to the client.",
                    "created_at": "2026-01-30T10:26:39.471560236Z",
                    "updated_at": null
                }
            ],
            "created_at": "2026-01-30T10:25:14.95758343Z",
            "updated_at": null
        }
    ]
}
