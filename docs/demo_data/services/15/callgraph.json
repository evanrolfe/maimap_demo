{"nodes":[{"code":"func main() {\n\t// Load configuration\n\tcfg := config.NewServiceConfig(\"user\", 8081)\n\t// Override defaults for user service database\n\tdbCfg := config.DatabaseConfig{\n\t\tHost:     config.GetEnv(\"USER_DB_HOST\", \"localhost\"),\n\t\tPort:     config.GetEnvInt(\"USER_DB_PORT\", 5432),\n\t\tUser:     config.GetEnv(\"USER_DB_USER\", \"rinder\"),\n\t\tPassword: config.GetEnv(\"USER_DB_PASSWORD\", \"rinder123\"),\n\t\tDatabase: config.GetEnv(\"USER_DB_NAME\", \"rinder_users\"),\n\t\tSSLMode:  config.GetEnv(\"USER_DB_SSLMODE\", \"disable\"),\n\t}\n\tkafkaCfg := config.NewKafkaConfig(\"user-service\")\n\tjwtCfg := config.NewJWTConfig()\n\n\t// Initialize logger\n\tlogger.Init(cfg.Name, cfg.LogLevel)\n\tlogger.Info(\"starting user service\",\n\t\tzap.Int(\"port\", cfg.Port),\n\t\tzap.String(\"environment\", cfg.Environment),\n\t)\n\n\t// Connect to database\n\tdsn := fmt.Sprintf(\"host=%s port=%d user=%s password=%s dbname=%s sslmode=%s\",\n\t\tdbCfg.Host, dbCfg.Port, dbCfg.User, dbCfg.Password, dbCfg.Database, dbCfg.SSLMode)\n\n\tdb, err := sql.Open(\"postgres\", dsn)\n\tif err != nil {\n\t\tlogger.Fatal(\"failed to connect to database\", zap.Error(err))\n\t}\n\tdefer db.Close()\n\n\t// Configure connection pool\n\tdb.SetMaxOpenConns(25)\n\tdb.SetMaxIdleConns(25)\n\tdb.SetConnMaxLifetime(5 * time.Minute)\n\n\t// Test connection\n\tif err := db.Ping(); err != nil {\n\t\tlogger.Fatal(\"failed to ping database\", zap.Error(err))\n\t}\n\tlogger.Info(\"connected to database\")\n\n\t// Run migrations\n\tif err := runMigrations(db); err != nil {\n\t\tlogger.Fatal(\"failed to run migrations\", zap.Error(err))\n\t}\n\n\t// Initialize Kafka producer\n\tproducer := kafka.NewProducer(kafkaCfg.Brokers, cfg.Name)\n\tdefer producer.Close()\n\n\t// Initialize repository\n\tuserRepo := repository.NewUserRepository(db)\n\n\t// Initialize JWT auth\n\tjwtAuth := middleware.NewJWTAuth(jwtCfg.Secret)\n\n\t// Initialize service\n\tuserService := service.NewUserService(userRepo, producer, jwtAuth, jwtCfg)\n\n\t// Initialize handler\n\th := handler.NewHandler(userService)\n\n\t// Setup routes\n\tmux := http.NewServeMux()\n\th.RegisterRoutes(mux)\n\n\t// Apply middleware (CORS is handled by the gateway)\n\tvar httpHandler http.Handler = mux\n\thttpHandler = middleware.Logging(httpHandler)\n\thttpHandler = middleware.Recovery(httpHandler)\n\n\t// Create server\n\tserver := \u0026http.Server{\n\t\tAddr:         fmt.Sprintf(\":%d\", cfg.Port),\n\t\tHandler:      httpHandler,\n\t\tReadTimeout:  15 * time.Second,\n\t\tWriteTimeout: 15 * time.Second,\n\t\tIdleTimeout:  60 * time.Second,\n\t}\n\n\t// Start server\n\tgo func() {\n\t\tlogger.Info(\"user service listening\", zap.String(\"addr\", server.Addr))\n\t\tif err := server.ListenAndServe(); err != nil \u0026\u0026 err != http.ErrServerClosed {\n\t\t\tlogger.Fatal(\"failed to start server\", zap.Error(err))\n\t\t}\n\t}()\n\n\t// Wait for interrupt signal\n\tquit := make(chan os.Signal, 1)\n\tsignal.Notify(quit, syscall.SIGINT, syscall.SIGTERM)\n\t\u003c-quit\n\n\tlogger.Info(\"shutting down server...\")\n\n\t// Graceful shutdown\n\tctx, cancel := context.WithTimeout(context.Background(), 30*time.Second)\n\tdefer cancel()\n\n\tif err := server.Shutdown(ctx); err != nil {\n\t\tlogger.Fatal(\"server forced to shutdown\", zap.Error(err))\n\t}\n\n\tlogger.Info(\"server exited properly\")\n}","external":"false","id":"/home/evan/Code/rinder/services/user/cmd/main.go:24:1","name":"ROOT","node_type":"function"},{"code":"func runMigrations(db *sql.DB) error {\n\tmigrations := []string{\n\t\t`CREATE TABLE IF NOT EXISTS users (\n\t\t\tid UUID PRIMARY KEY,\n\t\t\temail VARCHAR(255) UNIQUE NOT NULL,\n\t\t\tpassword_hash VARCHAR(255) NOT NULL,\n\t\t\tfirst_name VARCHAR(100),\n\t\t\tlast_name VARCHAR(100),\n\t\t\tstatus VARCHAR(20) DEFAULT 'active',\n\t\t\tcreated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n\t\t\tupdated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n\t\t)`,\n\t\t`CREATE INDEX IF NOT EXISTS idx_users_email ON users(email)`,\n\t\t`CREATE INDEX IF NOT EXISTS idx_users_status ON users(status)`,\n\t}\n\n\tfor _, migration := range migrations {\n\t\tif _, err := db.Exec(migration); err != nil {\n\t\t\treturn err\n\t\t}\n\t}\n\n\tlogger.Info(\"database migrations completed\")\n\treturn nil\n}","external":"false","id":"/home/evan/Code/rinder/services/user/cmd/main.go:132:6","name":"runMigrations","node_type":"function"},{"code":"func NewUserRepository(db *sql.DB) *UserRepository {\n\treturn \u0026UserRepository{db: db}\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:18:6","name":"NewUserRepository","node_type":"function"},{"code":"func NewUserService(\n\trepo *repository.UserRepository,\n\tproducer *kafka.Producer,\n\tjwtAuth *middleware.JWTAuth,\n\tjwtCfg config.JWTConfig,\n) *UserService {\n\treturn \u0026UserService{\n\t\trepo:     repo,\n\t\tproducer: producer,\n\t\tjwtAuth:  jwtAuth,\n\t\tjwtCfg:   jwtCfg,\n\t}\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:30:6","name":"NewUserService","node_type":"function"},{"code":"func NewHandler(userService *service.UserService) *Handler {\n\treturn \u0026Handler{\n\t\tuserService: userService,\n\t}\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:19:6","name":"NewHandler","node_type":"function"},{"code":"func (h *Handler) RegisterRoutes(mux *http.ServeMux) {\n\t// Health check\n\tmux.HandleFunc(\"/health\", h.healthCheck)\n\n\t// Auth routes\n\tmux.HandleFunc(\"/api/v1/auth/signup\", h.signup)\n\tmux.HandleFunc(\"/api/v1/auth/login\", h.login)\n\tmux.HandleFunc(\"/api/v1/auth/refresh\", h.refresh)\n\n\t// User routes (these expect X-User-ID header from gateway)\n\tmux.HandleFunc(\"/api/v1/users/me\", h.me)\n\tmux.HandleFunc(\"/api/v1/users/\", h.userByID)\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:26:19","name":"RegisterRoutes","node_type":"function"},{"code":"func (h *Handler) healthCheck(w http.ResponseWriter, r *http.Request) {\n\tw.Header().Set(\"Content-Type\", \"application/json\")\n\tw.WriteHeader(http.StatusOK)\n\tw.Write([]byte(`{\"status\":\"healthy\",\"service\":\"user\"}`))\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:40:19","name":"healthCheck","node_type":"function"},{"code":"func (h *Handler) signup(w http.ResponseWriter, r *http.Request) {\n\tif r.Method != http.MethodPost {\n\t\tresponse.Error(w, \u0026methodNotAllowedError{})\n\t\treturn\n\t}\n\n\tvar req model.SignupRequest\n\tif err := json.NewDecoder(r.Body).Decode(\u0026req); err != nil {\n\t\tresponse.Error(w, \u0026badRequestError{message: \"invalid request body\"})\n\t\treturn\n\t}\n\n\tresult, err := h.userService.Signup(r.Context(), \u0026req)\n\tif err != nil {\n\t\tresponse.Error(w, err)\n\t\treturn\n\t}\n\n\tresponse.Created(w, result)\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:46:19","name":"signup","node_type":"function"},{"code":"func (s *UserService) Signup(ctx context.Context, req *model.SignupRequest) (*model.AuthResponse, error) {\n\t// Validate request\n\tif err := s.validateSignupRequest(req); err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Check if user exists\n\texists, err := s.repo.ExistsByEmail(ctx, req.Email)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\tif exists {\n\t\treturn nil, errors.UserExists()\n\t}\n\n\t// Hash password\n\thashedPassword, err := bcrypt.GenerateFromPassword([]byte(req.Password), bcrypt.DefaultCost)\n\tif err != nil {\n\t\treturn nil, errors.Wrap(err, errors.CodeInternalServerError, \"failed to hash password\", 500)\n\t}\n\n\t// Create user\n\tnow := time.Now()\n\tuser := \u0026model.User{\n\t\tID:           uuid.New().String(),\n\t\tEmail:        req.Email,\n\t\tPasswordHash: string(hashedPassword),\n\t\tFirstName:    req.FirstName,\n\t\tLastName:     req.LastName,\n\t\tStatus:       model.UserStatusActive,\n\t\tCreatedAt:    now,\n\t\tUpdatedAt:    now,\n\t}\n\n\tif err := s.repo.Create(ctx, user); err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Generate tokens\n\taccessToken, err := s.jwtAuth.GenerateAccessToken(user.ID, user.Email, s.jwtCfg.AccessTokenTTL)\n\tif err != nil {\n\t\treturn nil, errors.Wrap(err, errors.CodeInternalServerError, \"failed to generate access token\", 500)\n\t}\n\n\trefreshToken, err := s.jwtAuth.GenerateRefreshToken(user.ID, user.Email, s.jwtCfg.RefreshTokenTTL)\n\tif err != nil {\n\t\treturn nil, errors.Wrap(err, errors.CodeInternalServerError, \"failed to generate refresh token\", 500)\n\t}\n\n\t// Publish user created event\n\tevent := model.UserCreatedEvent{\n\t\tUserID:    user.ID,\n\t\tEmail:     user.Email,\n\t\tFirstName: user.FirstName,\n\t\tLastName:  user.LastName,\n\t\tCreatedAt: user.CreatedAt,\n\t}\n\tif err := s.producer.PublishWithKey(ctx, kafka.TopicUserCreated, user.ID, kafka.EventUserCreated, event); err != nil {\n\t\tlogger.Error(\"failed to publish user created event\", zap.Error(err))\n\t\t// Don't fail the request, just log the error\n\t}\n\n\treturn \u0026model.AuthResponse{\n\t\tAccessToken:  accessToken,\n\t\tRefreshToken: refreshToken,\n\t\tExpiresIn:    int64(s.jwtCfg.AccessTokenTTL.Seconds()),\n\t\tUser:         user,\n\t}, nil\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:45:23","name":"Signup","node_type":"function"},{"code":"func (s *UserService) validateSignupRequest(req *model.SignupRequest) error {\n\t// Validate email\n\tif req.Email == \"\" {\n\t\treturn errors.ValidationError(\"email is required\")\n\t}\n\tif _, err := mail.ParseAddress(req.Email); err != nil {\n\t\treturn errors.ValidationError(\"invalid email format\")\n\t}\n\n\t// Validate password\n\tif req.Password == \"\" {\n\t\treturn errors.ValidationError(\"password is required\")\n\t}\n\tif len(req.Password) \u003c 8 {\n\t\treturn errors.ValidationError(\"password must be at least 8 characters\")\n\t}\n\tif !hasUpperCase(req.Password) {\n\t\treturn errors.ValidationError(\"password must contain at least one uppercase letter\")\n\t}\n\tif !hasLowerCase(req.Password) {\n\t\treturn errors.ValidationError(\"password must contain at least one lowercase letter\")\n\t}\n\tif !hasDigit(req.Password) {\n\t\treturn errors.ValidationError(\"password must contain at least one digit\")\n\t}\n\n\treturn nil\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:239:23","name":"validateSignupRequest","node_type":"function"},{"code":"func hasUpperCase(s string) bool {\n\tfor _, r := range s {\n\t\tif unicode.IsUpper(r) {\n\t\t\treturn true\n\t\t}\n\t}\n\treturn false\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:268:6","name":"hasUpperCase","node_type":"function"},{"code":"func hasLowerCase(s string) bool {\n\tfor _, r := range s {\n\t\tif unicode.IsLower(r) {\n\t\t\treturn true\n\t\t}\n\t}\n\treturn false\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:277:6","name":"hasLowerCase","node_type":"function"},{"code":"func hasDigit(s string) bool {\n\tfor _, r := range s {\n\t\tif unicode.IsDigit(r) {\n\t\t\treturn true\n\t\t}\n\t}\n\treturn false\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:286:6","name":"hasDigit","node_type":"function"},{"code":"func (r *UserRepository) ExistsByEmail(ctx context.Context, email string) (bool, error) {\n\tquery := `SELECT EXISTS(SELECT 1 FROM users WHERE email = $1)`\n\n\tvar exists bool\n\terr := r.db.QueryRowContext(ctx, query, email).Scan(\u0026exists)\n\tif err != nil {\n\t\treturn false, errors.Wrap(err, errors.CodeInternalServerError, \"failed to check user existence\", 500)\n\t}\n\n\treturn exists, nil\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:164:26","name":"ExistsByEmail","node_type":"function"},{"code":"func (r *UserRepository) Create(ctx context.Context, user *model.User) error {\n\tquery := `\n\t\tINSERT INTO users (id, email, password_hash, first_name, last_name, status, created_at, updated_at)\n\t\tVALUES ($1, $2, $3, $4, $5, $6, $7, $8)\n\t`\n\n\t_, err := r.db.ExecContext(ctx, query,\n\t\tuser.ID,\n\t\tuser.Email,\n\t\tuser.PasswordHash,\n\t\tuser.FirstName,\n\t\tuser.LastName,\n\t\tuser.Status,\n\t\tuser.CreatedAt,\n\t\tuser.UpdatedAt,\n\t)\n\n\tif err != nil {\n\t\tif isUniqueViolation(err) {\n\t\t\treturn errors.UserExists()\n\t\t}\n\t\treturn errors.Wrap(err, errors.CodeInternalServerError, \"failed to create user\", 500)\n\t}\n\n\treturn nil\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:23:26","name":"Create","node_type":"function"},{"code":"func isUniqueViolation(err error) bool {\n\t// PostgreSQL unique violation error code is 23505\n\treturn err != nil \u0026\u0026 (contains(err.Error(), \"unique\") || contains(err.Error(), \"23505\"))\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:177:6","name":"isUniqueViolation","node_type":"function"},{"code":"func contains(s, substr string) bool {\n\treturn len(s) \u003e= len(substr) \u0026\u0026 (s == substr || len(s) \u003e 0 \u0026\u0026 containsRune(s, substr))\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:182:6","name":"contains","node_type":"function"},{"code":"func containsRune(s, substr string) bool {\n\tfor i := 0; i \u003c= len(s)-len(substr); i++ {\n\t\tif s[i:i+len(substr)] == substr {\n\t\t\treturn true\n\t\t}\n\t}\n\treturn false\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:186:6","name":"containsRune","node_type":"function"},{"code":"func (h *Handler) login(w http.ResponseWriter, r *http.Request) {\n\tif r.Method != http.MethodPost {\n\t\tresponse.Error(w, \u0026methodNotAllowedError{})\n\t\treturn\n\t}\n\n\tvar req model.LoginRequest\n\tif err := json.NewDecoder(r.Body).Decode(\u0026req); err != nil {\n\t\tresponse.Error(w, \u0026badRequestError{message: \"invalid request body\"})\n\t\treturn\n\t}\n\n\tresult, err := h.userService.Login(r.Context(), \u0026req)\n\tif err != nil {\n\t\tresponse.Error(w, err)\n\t\treturn\n\t}\n\n\tresponse.OK(w, result)\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:67:19","name":"login","node_type":"function"},{"code":"func (s *UserService) Login(ctx context.Context, req *model.LoginRequest) (*model.AuthResponse, error) {\n\t// Validate request\n\tif req.Email == \"\" || req.Password == \"\" {\n\t\treturn nil, errors.ValidationError(\"email and password are required\")\n\t}\n\n\t// Get user by email\n\tuser, err := s.repo.GetByEmail(ctx, req.Email)\n\tif err != nil {\n\t\tif appErr, ok := err.(*errors.AppError); ok \u0026\u0026 appErr.Code == errors.CodeNotFound {\n\t\t\treturn nil, errors.InvalidCredentials()\n\t\t}\n\t\treturn nil, err\n\t}\n\n\t// Check password\n\tif err := bcrypt.CompareHashAndPassword([]byte(user.PasswordHash), []byte(req.Password)); err != nil {\n\t\treturn nil, errors.InvalidCredentials()\n\t}\n\n\t// Check user status\n\tif user.Status != model.UserStatusActive {\n\t\treturn nil, errors.Forbidden(\"user account is not active\")\n\t}\n\n\t// Generate tokens\n\taccessToken, err := s.jwtAuth.GenerateAccessToken(user.ID, user.Email, s.jwtCfg.AccessTokenTTL)\n\tif err != nil {\n\t\treturn nil, errors.Wrap(err, errors.CodeInternalServerError, \"failed to generate access token\", 500)\n\t}\n\n\trefreshToken, err := s.jwtAuth.GenerateRefreshToken(user.ID, user.Email, s.jwtCfg.RefreshTokenTTL)\n\tif err != nil {\n\t\treturn nil, errors.Wrap(err, errors.CodeInternalServerError, \"failed to generate refresh token\", 500)\n\t}\n\n\treturn \u0026model.AuthResponse{\n\t\tAccessToken:  accessToken,\n\t\tRefreshToken: refreshToken,\n\t\tExpiresIn:    int64(s.jwtCfg.AccessTokenTTL.Seconds()),\n\t\tUser:         user,\n\t}, nil\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:116:23","name":"Login","node_type":"function"},{"code":"func (r *UserRepository) GetByEmail(ctx context.Context, email string) (*model.User, error) {\n\tquery := `\n\t\tSELECT id, email, password_hash, first_name, last_name, status, created_at, updated_at\n\t\tFROM users\n\t\tWHERE email = $1\n\t`\n\n\tuser := \u0026model.User{}\n\terr := r.db.QueryRowContext(ctx, query, email).Scan(\n\t\t\u0026user.ID,\n\t\t\u0026user.Email,\n\t\t\u0026user.PasswordHash,\n\t\t\u0026user.FirstName,\n\t\t\u0026user.LastName,\n\t\t\u0026user.Status,\n\t\t\u0026user.CreatedAt,\n\t\t\u0026user.UpdatedAt,\n\t)\n\n\tif err == sql.ErrNoRows {\n\t\treturn nil, errors.NotFound(\"user not found\")\n\t}\n\tif err != nil {\n\t\treturn nil, errors.Wrap(err, errors.CodeInternalServerError, \"failed to get user\", 500)\n\t}\n\n\treturn user, nil\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:81:26","name":"GetByEmail","node_type":"function"},{"code":"func (h *Handler) refresh(w http.ResponseWriter, r *http.Request) {\n\tif r.Method != http.MethodPost {\n\t\tresponse.Error(w, \u0026methodNotAllowedError{})\n\t\treturn\n\t}\n\n\tvar req model.RefreshRequest\n\tif err := json.NewDecoder(r.Body).Decode(\u0026req); err != nil {\n\t\tresponse.Error(w, \u0026badRequestError{message: \"invalid request body\"})\n\t\treturn\n\t}\n\n\tresult, err := h.userService.RefreshToken(r.Context(), \u0026req)\n\tif err != nil {\n\t\tresponse.Error(w, err)\n\t\treturn\n\t}\n\n\tresponse.OK(w, result)\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:88:19","name":"refresh","node_type":"function"},{"code":"func (s *UserService) RefreshToken(ctx context.Context, req *model.RefreshRequest) (*model.RefreshResponse, error) {\n\tif req.RefreshToken == \"\" {\n\t\treturn nil, errors.ValidationError(\"refresh token is required\")\n\t}\n\n\t// Validate refresh token\n\tclaims, err := s.jwtAuth.ValidateToken(req.RefreshToken)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Check if user still exists and is active\n\tuser, err := s.repo.GetByID(ctx, claims.UserID)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tif user.Status != model.UserStatusActive {\n\t\treturn nil, errors.Forbidden(\"user account is not active\")\n\t}\n\n\t// Generate new tokens\n\taccessToken, err := s.jwtAuth.GenerateAccessToken(user.ID, user.Email, s.jwtCfg.AccessTokenTTL)\n\tif err != nil {\n\t\treturn nil, errors.Wrap(err, errors.CodeInternalServerError, \"failed to generate access token\", 500)\n\t}\n\n\trefreshToken, err := s.jwtAuth.GenerateRefreshToken(user.ID, user.Email, s.jwtCfg.RefreshTokenTTL)\n\tif err != nil {\n\t\treturn nil, errors.Wrap(err, errors.CodeInternalServerError, \"failed to generate refresh token\", 500)\n\t}\n\n\treturn \u0026model.RefreshResponse{\n\t\tAccessToken:  accessToken,\n\t\tRefreshToken: refreshToken,\n\t\tExpiresIn:    int64(s.jwtCfg.AccessTokenTTL.Seconds()),\n\t}, nil\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:161:23","name":"RefreshToken","node_type":"function"},{"code":"func (r *UserRepository) GetByID(ctx context.Context, id string) (*model.User, error) {\n\tquery := `\n\t\tSELECT id, email, password_hash, first_name, last_name, status, created_at, updated_at\n\t\tFROM users\n\t\tWHERE id = $1\n\t`\n\n\tuser := \u0026model.User{}\n\terr := r.db.QueryRowContext(ctx, query, id).Scan(\n\t\t\u0026user.ID,\n\t\t\u0026user.Email,\n\t\t\u0026user.PasswordHash,\n\t\t\u0026user.FirstName,\n\t\t\u0026user.LastName,\n\t\t\u0026user.Status,\n\t\t\u0026user.CreatedAt,\n\t\t\u0026user.UpdatedAt,\n\t)\n\n\tif err == sql.ErrNoRows {\n\t\treturn nil, errors.NotFound(\"user not found\")\n\t}\n\tif err != nil {\n\t\treturn nil, errors.Wrap(err, errors.CodeInternalServerError, \"failed to get user\", 500)\n\t}\n\n\treturn user, nil\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:51:26","name":"GetByID","node_type":"function"},{"code":"func (h *Handler) me(w http.ResponseWriter, r *http.Request) {\n\tuserID := r.Header.Get(\"X-User-ID\")\n\tif userID == \"\" {\n\t\tresponse.Error(w, \u0026unauthorizedError{})\n\t\treturn\n\t}\n\n\tswitch r.Method {\n\tcase http.MethodGet:\n\t\tuser, err := h.userService.GetUser(r.Context(), userID)\n\t\tif err != nil {\n\t\t\tresponse.Error(w, err)\n\t\t\treturn\n\t\t}\n\t\tresponse.OK(w, user)\n\n\tcase http.MethodPut:\n\t\tvar req model.UpdateUserRequest\n\t\tif err := json.NewDecoder(r.Body).Decode(\u0026req); err != nil {\n\t\t\tresponse.Error(w, \u0026badRequestError{message: \"invalid request body\"})\n\t\t\treturn\n\t\t}\n\n\t\tuser, err := h.userService.UpdateUser(r.Context(), userID, \u0026req)\n\t\tif err != nil {\n\t\t\tresponse.Error(w, err)\n\t\t\treturn\n\t\t}\n\t\tresponse.OK(w, user)\n\n\tdefault:\n\t\tresponse.Error(w, \u0026methodNotAllowedError{})\n\t}\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:109:19","name":"me","node_type":"function"},{"code":"func (s *UserService) GetUser(ctx context.Context, id string) (*model.User, error) {\n\treturn s.repo.GetByID(ctx, id)\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:201:23","name":"GetUser","node_type":"function"},{"code":"func (s *UserService) UpdateUser(ctx context.Context, id string, req *model.UpdateUserRequest) (*model.User, error) {\n\tuser, err := s.repo.GetByID(ctx, id)\n\tif err != nil {\n\t\treturn nil, err\n\t}\n\n\tif req.FirstName != \"\" {\n\t\tuser.FirstName = req.FirstName\n\t}\n\tif req.LastName != \"\" {\n\t\tuser.LastName = req.LastName\n\t}\n\n\tif err := s.repo.Update(ctx, user); err != nil {\n\t\treturn nil, err\n\t}\n\n\t// Publish user updated event\n\tevent := model.UserUpdatedEvent{\n\t\tUserID:    user.ID,\n\t\tEmail:     user.Email,\n\t\tFirstName: user.FirstName,\n\t\tLastName:  user.LastName,\n\t\tUpdatedAt: user.UpdatedAt,\n\t}\n\tif err := s.producer.PublishWithKey(ctx, kafka.TopicUserUpdated, user.ID, kafka.EventUserUpdated, event); err != nil {\n\t\tlogger.Error(\"failed to publish user updated event\", zap.Error(err))\n\t}\n\n\treturn user, nil\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:206:23","name":"UpdateUser","node_type":"function"},{"code":"func (r *UserRepository) Update(ctx context.Context, user *model.User) error {\n\tquery := `\n\t\tUPDATE users\n\t\tSET first_name = $1, last_name = $2, updated_at = $3\n\t\tWHERE id = $4\n\t`\n\n\tuser.UpdatedAt = time.Now()\n\tresult, err := r.db.ExecContext(ctx, query,\n\t\tuser.FirstName,\n\t\tuser.LastName,\n\t\tuser.UpdatedAt,\n\t\tuser.ID,\n\t)\n\n\tif err != nil {\n\t\treturn errors.Wrap(err, errors.CodeInternalServerError, \"failed to update user\", 500)\n\t}\n\n\trowsAffected, err := result.RowsAffected()\n\tif err != nil {\n\t\treturn errors.Wrap(err, errors.CodeInternalServerError, \"failed to get rows affected\", 500)\n\t}\n\n\tif rowsAffected == 0 {\n\t\treturn errors.NotFound(\"user not found\")\n\t}\n\n\treturn nil\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:111:26","name":"Update","node_type":"function"},{"code":"func (h *Handler) userByID(w http.ResponseWriter, r *http.Request) {\n\t// Extract user ID from path /api/v1/users/{id}\n\tpath := strings.TrimPrefix(r.URL.Path, \"/api/v1/users/\")\n\tuserID := strings.TrimSuffix(path, \"/\")\n\n\tif userID == \"\" {\n\t\tresponse.Error(w, \u0026badRequestError{message: \"user ID is required\"})\n\t\treturn\n\t}\n\n\tswitch r.Method {\n\tcase http.MethodGet:\n\t\tuser, err := h.userService.GetUser(r.Context(), userID)\n\t\tif err != nil {\n\t\t\tresponse.Error(w, err)\n\t\t\treturn\n\t\t}\n\t\tresponse.OK(w, user)\n\n\tdefault:\n\t\tresponse.Error(w, \u0026methodNotAllowedError{})\n\t}\n}","external":"false","id":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:144:19","name":"userByID","node_type":"function"}],"links":[{"column":11,"line":67,"source":"/home/evan/Code/rinder/services/user/cmd/main.go:24:1","target":"/home/evan/Code/rinder/services/user/cmd/main.go:132:6","val":1},{"column":24,"line":76,"source":"/home/evan/Code/rinder/services/user/cmd/main.go:24:1","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:18:6","val":1},{"column":24,"line":82,"source":"/home/evan/Code/rinder/services/user/cmd/main.go:24:1","target":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:30:6","val":1},{"column":14,"line":85,"source":"/home/evan/Code/rinder/services/user/cmd/main.go:24:1","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:19:6","val":1},{"column":3,"line":89,"source":"/home/evan/Code/rinder/services/user/cmd/main.go:24:1","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:26:19","val":1},{"column":29,"line":27,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:26:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:40:19","val":1},{"column":41,"line":30,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:26:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:46:19","val":1},{"column":17,"line":47,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:46:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:46:19","val":1},{"column":17,"line":53,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:46:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:46:19","val":1},{"column":30,"line":57,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:46:19","target":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:45:23","val":1},{"column":13,"line":46,"source":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:45:23","target":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:239:23","val":1},{"column":5,"line":254,"source":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:239:23","target":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:268:6","val":1},{"column":5,"line":257,"source":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:239:23","target":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:277:6","val":1},{"column":5,"line":260,"source":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:239:23","target":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:286:6","val":1},{"column":35,"line":46,"source":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:45:23","target":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:45:23","val":1},{"column":23,"line":51,"source":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:45:23","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:164:26","val":1},{"column":29,"line":167,"source":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:164:26","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:164:26","val":1},{"column":41,"line":167,"source":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:164:26","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:164:26","val":1},{"column":37,"line":51,"source":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:45:23","target":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:45:23","val":1},{"column":18,"line":78,"source":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:45:23","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:23:26","val":1},{"column":28,"line":28,"source":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:23:26","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:23:26","val":1},{"column":5,"line":40,"source":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:23:26","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:177:6","val":1},{"column":23,"line":178,"source":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:177:6","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:182:6","val":1},{"column":12,"line":182,"source":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:182:6","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:182:6","val":1},{"column":22,"line":182,"source":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:182:6","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:182:6","val":1},{"column":53,"line":182,"source":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:182:6","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:182:6","val":1},{"column":63,"line":182,"source":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:182:6","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:186:6","val":1},{"column":22,"line":186,"source":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:186:6","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:186:6","val":1},{"column":29,"line":186,"source":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:186:6","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:186:6","val":1},{"column":15,"line":187,"source":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:186:6","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:186:6","val":1},{"column":76,"line":182,"source":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:182:6","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:182:6","val":1},{"column":79,"line":182,"source":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:182:6","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:182:6","val":1},{"column":58,"line":178,"source":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:177:6","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:182:6","val":1},{"column":25,"line":78,"source":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:45:23","target":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:45:23","val":1},{"column":37,"line":101,"source":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:45:23","target":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:45:23","val":1},{"column":17,"line":59,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:46:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:46:19","val":1},{"column":18,"line":63,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:46:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:46:19","val":1},{"column":40,"line":31,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:26:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:67:19","val":1},{"column":17,"line":68,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:67:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:67:19","val":1},{"column":17,"line":74,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:67:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:67:19","val":1},{"column":30,"line":78,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:67:19","target":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:116:23","val":1},{"column":21,"line":122,"source":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:116:23","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:81:26","val":1},{"column":29,"line":88,"source":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:81:26","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:81:26","val":1},{"column":41,"line":88,"source":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:81:26","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:81:26","val":1},{"column":32,"line":122,"source":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:116:23","target":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:116:23","val":1},{"column":17,"line":80,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:67:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:67:19","val":1},{"column":13,"line":84,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:67:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:67:19","val":1},{"column":42,"line":32,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:26:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:88:19","val":1},{"column":17,"line":89,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:88:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:88:19","val":1},{"column":17,"line":95,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:88:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:88:19","val":1},{"column":30,"line":99,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:88:19","target":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:161:23","val":1},{"column":21,"line":172,"source":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:161:23","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:51:26","val":1},{"column":29,"line":58,"source":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:51:26","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:51:26","val":1},{"column":41,"line":58,"source":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:51:26","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:51:26","val":1},{"column":29,"line":172,"source":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:161:23","target":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:161:23","val":1},{"column":17,"line":101,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:88:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:88:19","val":1},{"column":13,"line":105,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:88:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:88:19","val":1},{"column":38,"line":35,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:26:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:109:19","val":1},{"column":17,"line":111,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:109:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:109:19","val":1},{"column":29,"line":117,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:109:19","target":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:201:23","val":1},{"column":15,"line":201,"source":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:201:23","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:51:26","val":1},{"column":23,"line":201,"source":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:201:23","target":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:201:23","val":1},{"column":28,"line":201,"source":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:201:23","target":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:201:23","val":1},{"column":18,"line":119,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:109:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:109:19","val":1},{"column":14,"line":122,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:109:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:109:19","val":1},{"column":18,"line":127,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:109:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:109:19","val":1},{"column":29,"line":131,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:109:19","target":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:206:23","val":1},{"column":21,"line":206,"source":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:206:23","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:51:26","val":1},{"column":29,"line":206,"source":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:206:23","target":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:206:23","val":1},{"column":34,"line":206,"source":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:206:23","target":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:206:23","val":1},{"column":18,"line":218,"source":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:206:23","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:111:26","val":1},{"column":33,"line":118,"source":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:111:26","target":"/home/evan/Code/rinder/services/user/internal/repository/user_repository.go:111:26","val":1},{"column":25,"line":218,"source":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:206:23","target":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:206:23","val":1},{"column":37,"line":230,"source":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:206:23","target":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:206:23","val":1},{"column":18,"line":133,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:109:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:109:19","val":1},{"column":14,"line":136,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:109:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:109:19","val":1},{"column":17,"line":139,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:109:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:109:19","val":1},{"column":36,"line":36,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:26:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:144:19","val":1},{"column":17,"line":149,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:144:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:144:19","val":1},{"column":29,"line":155,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:144:19","target":"/home/evan/Code/rinder/services/user/internal/service/user_service.go:201:23","val":1},{"column":18,"line":157,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:144:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:144:19","val":1},{"column":14,"line":160,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:144:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:144:19","val":1},{"column":17,"line":163,"source":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:144:19","target":"/home/evan/Code/rinder/services/user/internal/handler/handler.go:144:19","val":1}]}