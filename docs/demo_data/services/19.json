{
    "id": 19,
    "name": "service-payment-braintree",
    "git_repo_url": "/home/evan/Code/rinder/services/payment-braintree",
    "entrypoint_path": "cmd/main.go",
    "entrypoint_function": "main",
    "git_org_url": "github.com/rinder",
    "git_commit": null,
    "created_at": "2026-01-30T09:45:04.58756129Z",
    "updated_at": "2026-01-30T09:45:07.255103453Z",
    "status": "analyzing-completed",
    "handlers": [
        {
            "id": 251,
            "type": "http",
            "method": "GET",
            "path": "/api/v1/client-token",
            "source_function_name": "RegisterRoutes",
            "function_name": "clientToken",
            "source_function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:25:19",
            "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:127:19",
            "outputs": [
                {
                    "id": 1501,
                    "handler_id": 251,
                    "type": "http",
                    "label": "Braintree Create Customer API call (Customer().Create)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/service/braintree_service.go:238:28",
                    "function_name": "getOrCreateCustomer",
                    "description": "When generating the client token, the service ensures a Braintree customer exists. If no cached customer ID exists for the given user_id, it issues a call to the Braintree API to create a customer with CustomFields {\"user_id\": user_id}. This external HTTP call may fail; on failure the code creates a mock customer ID locally and does not persist it to Braintree.",
                    "created_at": "2026-01-30T09:46:10.149378503Z",
                    "updated_at": null
                },
                {
                    "id": 1502,
                    "handler_id": 251,
                    "type": "http",
                    "label": "Braintree Generate Client Token API call (ClientToken().Generate)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/service/braintree_service.go:264:28",
                    "function_name": "GenerateClientToken",
                    "description": "After ensuring (or mocking) a customer, the service calls the Braintree API to generate a client token (ClientToken().Generate). If this external call fails, the service returns a generated demo placeholder token instead of failing the request.",
                    "created_at": "2026-01-30T09:46:10.150518543Z",
                    "updated_at": null
                },
                {
                    "id": 1497,
                    "handler_id": 251,
                    "type": "http_response",
                    "label": "HTTP 200 JSON response with client_token",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:127:19",
                    "function_name": "clientToken",
                    "description": "If request method is GET and a user_id query parameter is provided and GenerateClientToken returns a token, the handler writes an HTTP 200 response containing JSON {\"client_token\": \"\u003ctoken\u003e\"} to the client.",
                    "created_at": "2026-01-30T09:46:10.130829658Z",
                    "updated_at": null
                },
                {
                    "id": 1499,
                    "handler_id": 251,
                    "type": "http_response",
                    "label": "HTTP 400 Bad Request response (missing user_id)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:127:19",
                    "function_name": "clientToken",
                    "description": "If the user_id query parameter is missing or empty, the handler returns an HTTP error response for a bad request (via response.Error).",
                    "created_at": "2026-01-30T09:46:10.146302033Z",
                    "updated_at": null
                },
                {
                    "id": 1498,
                    "handler_id": 251,
                    "type": "http_response",
                    "label": "HTTP 405 Method Not Allowed response",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:127:19",
                    "function_name": "clientToken",
                    "description": "If the incoming HTTP request method is not GET, the handler returns an HTTP error response indicating method not allowed (via response.Error).",
                    "created_at": "2026-01-30T09:46:10.143434593Z",
                    "updated_at": null
                },
                {
                    "id": 1500,
                    "handler_id": 251,
                    "type": "http_response",
                    "label": "HTTP error response from GenerateClientToken failure",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:127:19",
                    "function_name": "clientToken",
                    "description": "If BraintreeService.GenerateClientToken returns an error, the handler returns an HTTP error response to the client (via response.Error). The exact HTTP status depends on response.Error's implementation.",
                    "created_at": "2026-01-30T09:46:10.14812774Z",
                    "updated_at": null
                }
            ],
            "created_at": "2026-01-30T09:45:33.62538803Z",
            "updated_at": null
        },
        {
            "id": 249,
            "type": "http",
            "method": "GET",
            "path": "/api/v1/payment-methods",
            "source_function_name": "RegisterRoutes",
            "function_name": "paymentMethods",
            "source_function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:25:19",
            "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:92:19",
            "outputs": [
                {
                    "id": 1519,
                    "handler_id": 249,
                    "type": "http",
                    "label": "HTTP request to Braintree: Create Customer",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/service/braintree_service.go:238:28",
                    "function_name": "getOrCreateCustomer",
                    "description": "When creating a payment method for a user without a cached customer ID, the service invokes the Braintree client to create a Customer (s.client.Customer().Create). This is an outbound HTTP call to the Braintree API; if it fails the code falls back to creating a mock customer ID locally.",
                    "created_at": "2026-01-30T09:46:24.652842154Z",
                    "updated_at": null
                },
                {
                    "id": 1520,
                    "handler_id": 249,
                    "type": "http",
                    "label": "HTTP request to Braintree: Create Payment Method",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/service/braintree_service.go:168:28",
                    "function_name": "CreatePaymentMethod",
                    "description": "During POST processing, the service calls the Braintree client's PaymentMethod().Create to create a payment method from the provided nonce/token. This is an outbound HTTP call to the Braintree API; on error the code continues and creates a mock payment method locally.",
                    "created_at": "2026-01-30T09:46:24.654198264Z",
                    "updated_at": null
                },
                {
                    "id": 1516,
                    "handler_id": 249,
                    "type": "http_response",
                    "label": "HTTP 200 OK (GET payment methods)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:92:19",
                    "function_name": "paymentMethods",
                    "description": "On a successful GET with a user_id, the handler returns an HTTP 200 response containing the list of payment methods (possibly empty) as the response body.",
                    "created_at": "2026-01-30T09:46:24.646267839Z",
                    "updated_at": null
                },
                {
                    "id": 1521,
                    "handler_id": 249,
                    "type": "http_response",
                    "label": "HTTP 201 Created (payment method created)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:92:19",
                    "function_name": "paymentMethods",
                    "description": "On successful POST processing (CreatePaymentMethod returns a payment method or a mock used as fallback), the handler returns an HTTP 201 Created response with the created payment method in the response body.",
                    "created_at": "2026-01-30T09:46:24.655547628Z",
                    "updated_at": null
                },
                {
                    "id": 1518,
                    "handler_id": 249,
                    "type": "http_response",
                    "label": "HTTP 400 Bad Request (invalid POST body)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:92:19",
                    "function_name": "paymentMethods",
                    "description": "If the POST request body is invalid JSON and cannot be decoded into a CreatePaymentMethodRequest, the handler returns an HTTP error response (bad request).",
                    "created_at": "2026-01-30T09:46:24.650483044Z",
                    "updated_at": null
                },
                {
                    "id": 1515,
                    "handler_id": 249,
                    "type": "http_response",
                    "label": "HTTP 400 Bad Request (missing user_id)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:92:19",
                    "function_name": "paymentMethods",
                    "description": "If the GET request is missing the required user_id query parameter, the handler returns an HTTP error response (bad request).",
                    "created_at": "2026-01-30T09:46:24.633125617Z",
                    "updated_at": null
                },
                {
                    "id": 1522,
                    "handler_id": 249,
                    "type": "http_response",
                    "label": "HTTP error (CreatePaymentMethod failed)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:92:19",
                    "function_name": "paymentMethods",
                    "description": "If h.braintreeService.CreatePaymentMethod returns an error while processing a POST request, the handler returns an HTTP error response to the client.",
                    "created_at": "2026-01-30T09:46:24.656730187Z",
                    "updated_at": null
                },
                {
                    "id": 1517,
                    "handler_id": 249,
                    "type": "http_response",
                    "label": "HTTP error (GetPaymentMethods failed)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:92:19",
                    "function_name": "paymentMethods",
                    "description": "If h.braintreeService.GetPaymentMethods returns an error during processing of a GET request, the handler returns an HTTP error response to the client.",
                    "created_at": "2026-01-30T09:46:24.649140695Z",
                    "updated_at": null
                },
                {
                    "id": 1523,
                    "handler_id": 249,
                    "type": "http_response",
                    "label": "HTTP error (method not allowed)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:92:19",
                    "function_name": "paymentMethods",
                    "description": "If the request method is neither GET nor POST, the handler returns an HTTP error response indicating the method is not allowed.",
                    "created_at": "2026-01-30T09:46:24.657918532Z",
                    "updated_at": null
                }
            ],
            "created_at": "2026-01-30T09:45:33.623149774Z",
            "updated_at": null
        },
        {
            "id": 246,
            "type": "http",
            "method": "GET",
            "path": "/health",
            "source_function_name": "RegisterRoutes",
            "function_name": "healthCheck",
            "source_function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:25:19",
            "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:40:19",
            "outputs": [
                {
                    "id": 1496,
                    "handler_id": 246,
                    "type": "http_response",
                    "label": "HTTP 200 JSON response",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:40:19",
                    "function_name": "healthCheck",
                    "description": "The HTTP handler writes a 200 OK response with Content-Type: application/json and the JSON body {\"status\":\"healthy\",\"service\":\"payment-braintree\",\"provider\":\"braintree\"}. This is returned to the client that invoked the handler.",
                    "created_at": "2026-01-30T09:45:45.646427951Z",
                    "updated_at": null
                }
            ],
            "created_at": "2026-01-30T09:45:33.60565764Z",
            "updated_at": null
        },
        {
            "id": 247,
            "type": "http",
            "method": "POST",
            "path": "/api/v1/charge",
            "source_function_name": "RegisterRoutes",
            "function_name": "charge",
            "source_function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:25:19",
            "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:46:19",
            "outputs": [
                {
                    "id": 1511,
                    "handler_id": 247,
                    "type": "http",
                    "label": "Braintree Customer Create API call (Customer().Create)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/service/braintree_service.go:238:28",
                    "function_name": "getOrCreateCustomer",
                    "description": "If there is no cached Braintree customer ID for the given user, the service will call the Braintree Customer Create API via s.client.Customer().Create(ctx, customerReq). This call may succeed (returning a Braintree customer ID) or fail; on failure the code generates a local mock customer ID and continues without propagating the error.",
                    "created_at": "2026-01-30T09:46:22.94712167Z",
                    "updated_at": null
                },
                {
                    "id": 1512,
                    "handler_id": 247,
                    "type": "http",
                    "label": "Braintree Transaction Create API call (Transaction().Create)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/service/braintree_service.go:40:28",
                    "function_name": "Charge",
                    "description": "When a payment method token (PaymentMethodID) is provided in the request, the service will call the Braintree Transaction Create API via s.client.Transaction().Create(ctx, txnReq) to create/submit a transaction. If that API call returns an error, the code falls back to simulating a successful charge instead of returning the error.",
                    "created_at": "2026-01-30T09:46:22.948698868Z",
                    "updated_at": null
                },
                {
                    "id": 1513,
                    "handler_id": 247,
                    "type": "http_response",
                    "label": "HTTP 200 response with ChargeResponse (success or failure payload)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:46:19",
                    "function_name": "charge",
                    "description": "On normal completion (the BraintreeService returns a ChargeResponse and nil error), the handler writes an HTTP 200 response to the client containing the ChargeResponse (success/failure/status/transaction id) in the response body.",
                    "created_at": "2026-01-30T09:46:22.950114351Z",
                    "updated_at": null
                },
                {
                    "id": 1510,
                    "handler_id": 247,
                    "type": "http_response",
                    "label": "HTTP error response (bad request - invalid JSON body)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:46:19",
                    "function_name": "charge",
                    "description": "If the request body cannot be decoded as the expected JSON ChargeRequest, the handler writes an HTTP error response to the client indicating a bad request (invalid request body, e.g., 400).",
                    "created_at": "2026-01-30T09:46:22.944375806Z",
                    "updated_at": null
                },
                {
                    "id": 1509,
                    "handler_id": 247,
                    "type": "http_response",
                    "label": "HTTP error response (method not allowed)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:46:19",
                    "function_name": "charge",
                    "description": "If the incoming HTTP request method is not POST, the handler writes an HTTP error response to the client indicating the method is not allowed (e.g., 405).",
                    "created_at": "2026-01-30T09:46:22.931270786Z",
                    "updated_at": null
                },
                {
                    "id": 1514,
                    "handler_id": 247,
                    "type": "http_response",
                    "label": "HTTP error response (propagated from service error)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:46:19",
                    "function_name": "charge",
                    "description": "If h.braintreeService.Charge returns a non-nil error, the handler writes an HTTP error response to the client based on that error (status depends on response.Error implementation).",
                    "created_at": "2026-01-30T09:46:22.951481536Z",
                    "updated_at": null
                }
            ],
            "created_at": "2026-01-30T09:45:33.617907737Z",
            "updated_at": null
        },
        {
            "id": 250,
            "type": "http",
            "method": "POST",
            "path": "/api/v1/payment-methods",
            "source_function_name": "RegisterRoutes",
            "function_name": "paymentMethods",
            "source_function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:25:19",
            "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:92:19",
            "outputs": [
                {
                    "id": 1526,
                    "handler_id": 250,
                    "type": "http",
                    "label": "Braintree Create Customer API call",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/service/braintree_service.go:238:28",
                    "function_name": "getOrCreateCustomer",
                    "description": "When creating a payment method for a user that does not have a cached Braintree customer ID, the service calls the Braintree Customer().Create API (via the Braintree client) to create a customer with custom_fields {\"user_id\": userID}. If this external call fails, the code falls back to generating a mock customer ID locally.",
                    "created_at": "2026-01-30T09:46:26.29080284Z",
                    "updated_at": null
                },
                {
                    "id": 1527,
                    "handler_id": 250,
                    "type": "http",
                    "label": "Braintree Create PaymentMethod API call",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/service/braintree_service.go:168:28",
                    "function_name": "CreatePaymentMethod",
                    "description": "When creating a payment method, the service calls the Braintree PaymentMethod().Create API (via the Braintree client) with a PaymentMethodRequest containing CustomerId, PaymentMethodNonce (token), and options (MakeDefault). If this external call fails, the code falls back to creating a mock payment method locally.",
                    "created_at": "2026-01-30T09:46:26.294279848Z",
                    "updated_at": null
                },
                {
                    "id": 1528,
                    "handler_id": 250,
                    "type": "http_response",
                    "label": "HTTP 200 OK (payment methods JSON)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:92:19",
                    "function_name": "paymentMethods",
                    "description": "For a GET /paymentMethods request with a valid user_id, the handler returns HTTP 200 with a JSON body containing the user's payment methods (an empty array if none are stored).",
                    "created_at": "2026-01-30T09:46:26.29586122Z",
                    "updated_at": null
                },
                {
                    "id": 1530,
                    "handler_id": 250,
                    "type": "http_response",
                    "label": "HTTP 201 Created (payment method JSON)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:92:19",
                    "function_name": "paymentMethods",
                    "description": "For a successful POST /paymentMethods request, after creating (or mock-creating) a payment method, the handler returns HTTP 201 with the created payment method as JSON in the response body.",
                    "created_at": "2026-01-30T09:46:26.298648943Z",
                    "updated_at": null
                },
                {
                    "id": 1529,
                    "handler_id": 250,
                    "type": "http_response",
                    "label": "HTTP 400 Bad Request (invalid request body)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:92:19",
                    "function_name": "paymentMethods",
                    "description": "If a POST /paymentMethods request contains an invalid JSON body (cannot be decoded into CreatePaymentMethodRequest), the handler returns an HTTP error response indicating a bad request.",
                    "created_at": "2026-01-30T09:46:26.297300366Z",
                    "updated_at": null
                },
                {
                    "id": 1525,
                    "handler_id": 250,
                    "type": "http_response",
                    "label": "HTTP 400 Bad Request (user_id is required)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:92:19",
                    "function_name": "paymentMethods",
                    "description": "If the GET /paymentMethods request omits the required user_id query parameter, the handler returns an HTTP error response to the client indicating a bad request.",
                    "created_at": "2026-01-30T09:46:26.278907466Z",
                    "updated_at": null
                },
                {
                    "id": 1531,
                    "handler_id": 250,
                    "type": "http_response",
                    "label": "HTTP error response (propagated service error)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:92:19",
                    "function_name": "paymentMethods",
                    "description": "If the Braintree service methods return an error (from GetPaymentMethods or CreatePaymentMethod), the handler propagates that error back to the client as an HTTP error response (status and body determined by the error handling layer).",
                    "created_at": "2026-01-30T09:46:26.299970124Z",
                    "updated_at": null
                }
            ],
            "created_at": "2026-01-30T09:45:33.624264962Z",
            "updated_at": null
        },
        {
            "id": 248,
            "type": "http",
            "method": "POST",
            "path": "/api/v1/refund",
            "source_function_name": "RegisterRoutes",
            "function_name": "refund",
            "source_function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:25:19",
            "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:71:19",
            "outputs": [
                {
                    "id": 1504,
                    "handler_id": 248,
                    "type": "http",
                    "label": "Braintree Transaction.Refund (full refund)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/service/braintree_service.go:123:28",
                    "function_name": "Refund",
                    "description": "A network call from the Braintree client to Braintree's Transaction.Refund API to issue a full refund for the given transaction ID (no amount supplied).",
                    "created_at": "2026-01-30T09:46:14.248209404Z",
                    "updated_at": null
                },
                {
                    "id": 1503,
                    "handler_id": 248,
                    "type": "http",
                    "label": "Braintree Transaction.Refund (partial amount)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/service/braintree_service.go:123:28",
                    "function_name": "Refund",
                    "description": "A network call from the Braintree client to Braintree's Transaction.Refund API to issue a partial refund for the given transaction ID and amount.",
                    "created_at": "2026-01-30T09:46:14.235853574Z",
                    "updated_at": null
                },
                {
                    "id": 1505,
                    "handler_id": 248,
                    "type": "http_response",
                    "label": "HTTP 200 JSON response (RefundResponse)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:71:19",
                    "function_name": "refund",
                    "description": "The HTTP handler writes a successful HTTP response to the client containing the RefundResponse payload (Success, RefundID, Status). This is produced when the service returns a RefundResponse and response.OK is called.",
                    "created_at": "2026-01-30T09:46:14.251731154Z",
                    "updated_at": null
                },
                {
                    "id": 1507,
                    "handler_id": 248,
                    "type": "http_response",
                    "label": "HTTP error response (bad request - invalid JSON body)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:71:19",
                    "function_name": "refund",
                    "description": "When the request body cannot be decoded as the expected RefundRequest, the handler returns a bad-request HTTP error response to the client via response.Error.",
                    "created_at": "2026-01-30T09:46:14.255239669Z",
                    "updated_at": null
                },
                {
                    "id": 1506,
                    "handler_id": 248,
                    "type": "http_response",
                    "label": "HTTP error response (method not allowed)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:71:19",
                    "function_name": "refund",
                    "description": "When the incoming request method is not POST, the handler returns an error HTTP response (method-not-allowed) to the client via response.Error.",
                    "created_at": "2026-01-30T09:46:14.253664553Z",
                    "updated_at": null
                },
                {
                    "id": 1508,
                    "handler_id": 248,
                    "type": "http_response",
                    "label": "HTTP error response (service error)",
                    "function_id": "/home/evan/Code/rinder/services/payment-braintree/internal/handler/handler.go:71:19",
                    "function_name": "refund",
                    "description": "If the BraintreeService.Refund call returns an error, the handler returns an HTTP error response to the client via response.Error. (Note: the BraintreeService may instead simulate a successful refund on API error and return a successful RefundResponse.)",
                    "created_at": "2026-01-30T09:46:14.256603257Z",
                    "updated_at": null
                }
            ],
            "created_at": "2026-01-30T09:45:33.62163603Z",
            "updated_at": null
        }
    ]
}
