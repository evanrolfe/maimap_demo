import{_ as Tt,b as It}from"../chunks/BRVk3zM3.js";import{c as ke,a as d,f as p,e as ie}from"../chunks/DZs8rR8k.js";import"../chunks/D2htM9l8.js";import{o as Mt}from"../chunks/CSfjm-6H.js";import{h as Se,a as Pt,a$ as Ot,b as it,I as Ft,b0 as Dt,L as jt,R as $t,a6 as Xe,P as Ze,K as et,Q as Rt,p as nt,j as ae,w as Gt,d as lt,v as tt,l as L,c as Bt,g as e,m as v,q as zt,e as o,s as f,f as n,i as Ht,u as m,r as s,k as W,n as at}from"../chunks/B4RuN_dZ.js";import{s as R}from"../chunks/Bwak9JMZ.js";import{B as Kt,i as G}from"../chunks/B2LozDeQ.js";import{e as rt,i as st}from"../chunks/dk5Fz5Mq.js";import{r as Ut}from"../chunks/C6Um85Qa.js";import{a as Wt}from"../chunks/Gaoq9xH0.js";import{i as Vt}from"../chunks/D_xYtrhe.js";import{b as Jt,r as Yt,s as qt,a as Qt}from"../chunks/h4F42on8.js";import{g as ot}from"../chunks/BA7Gc6yi.js";import{p as Xt}from"../chunks/Cp43rLF0.js";import{S as Zt,a as ea}from"../chunks/Cs_Tew0z.js";import{f as ta}from"../chunks/DJNhhgtY.js";import{H as $e}from"../chunks/BG_Koye0.js";import{f as aa,h as ra}from"../chunks/M8vgo97S.js";import{I as sa,s as oa}from"../chunks/Dt_7xDFP.js";import{A as ia}from"../chunks/CGKv0_vr.js";const na=Symbol("NaN");function la(E,P,g){Se&&Pt();var V=new Kt(E),B=!Ot();it(()=>{var l=P();l!==l&&(l=na),B&&l!==null&&typeof l=="object"&&(l={}),V.ensure(l,g)})}function ca(E,P){let g=null,V=Se;var B;if(Se){g=Rt;for(var l=jt(document.head);l!==null&&(l.nodeType!==$t||l.data!==E);)l=Xe(l);if(l===null)Ze(!1);else{var z=Xe(l);l.remove(),et(z)}}Se||(B=document.head.appendChild(Ft()));try{it(()=>P(B),Dt)}finally{V&&(Ze(!0),et(g))}}function da(E,P){nt(P,!0);let g=Yt(P,["$$slots","$$events","$$legacy"]);const V=[["path",{d:"m12 19-7-7 7-7"}],["path",{d:"M19 12H5"}]];sa(E,Jt({name:"arrow-left"},()=>g,{get iconNode(){return V},children:(B,l)=>{var z=ke(),w=ae(z);oa(w,()=>P.children??Gt),d(B,z)},$$slots:{default:!0}})),lt()}function va(E){const l={keyword:["break","case","chan","const","continue","default","defer","else","fallthrough","for","func","go","goto","if","import","interface","map","package","range","return","select","struct","switch","type","var"],type:["bool","byte","complex64","complex128","error","float32","float64","int8","int16","int32","int64","string","uint8","uint16","uint32","uint64","int","uint","uintptr","rune"],literal:["true","false","iota","nil"],built_in:["append","cap","close","complex","copy","imag","len","make","new","panic","print","println","real","recover","delete"]};return{name:"Go",aliases:["golang"],keywords:l,illegal:"</",contains:[E.C_LINE_COMMENT_MODE,E.C_BLOCK_COMMENT_MODE,{className:"string",variants:[E.QUOTE_STRING_MODE,E.APOS_STRING_MODE,{begin:"`",end:"`"}]},{className:"number",variants:[{match:/-?\b0[xX]\.[a-fA-F0-9](_?[a-fA-F0-9])*[pP][+-]?\d(_?\d)*i?/,relevance:0},{match:/-?\b0[xX](_?[a-fA-F0-9])+((\.([a-fA-F0-9](_?[a-fA-F0-9])*)?)?[pP][+-]?\d(_?\d)*)?i?/,relevance:0},{match:/-?\b0[oO](_?[0-7])*i?/,relevance:0},{match:/-?\.\d(_?\d)*([eE][+-]?\d(_?\d)*)?i?/,relevance:0},{match:/-?\b\d(_?\d)*(\.(\d(_?\d)*)?)?([eE][+-]?\d(_?\d)*)?i?/,relevance:0}]},{begin:/:=/},{className:"function",beginKeywords:"func",end:"\\s*(\\{|$)",excludeEnd:!0,contains:[E.TITLE_MODE,{className:"params",begin:/\(/,end:/\)/,endsParent:!0,keywords:l,illegal:/["']/}]}]}}var fa=p('<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"/>'),pa=p('<div class="card p-8 text-center"><p>Loading call graph...</p></div>'),ua=p('<div class="card p-8 text-center text-error-500"><p> </p></div>'),ga=p('<pre class="svelte-xu7n8e"><code id="node-code" class="language-go svelte-xu7n8e"> </code></pre>'),ha=p('<div><h3 class="text-surface-600-300-token mb-1 text-sm font-semibold">Code</h3> <div class="code-container svelte-xu7n8e"><!></div></div>'),_a=p('<li><button type="button" class="anchor text-sm hover:underline"> </button></li>'),ma=p('<ul class="list space-y-1"></ul>'),ba=p('<p class="text-surface-600-300-token text-sm">No outgoing calls</p>'),ya=p('<h1 class="h4"> </h1> <div class="space-y-3"><div class="flex gap-2"><button type="button" class="btn preset-filled-tertiary-500 btn-sm">Focus in Callgraph</button> <button type="button" class="btn preset-filled-tertiary-500 btn-sm">View Subgraph</button></div> <div><h3 class="text-surface-600-300-token mb-1 text-sm font-semibold">Location:</h3> <p class="font-mono text-sm break-all"> </p></div> <!> <div><h3 class="text-surface-600-300-token mb-1 text-sm font-semibold">Calls</h3> <!></div></div>',1),xa=p('<h1 class="h4">Node</h1> <p class="text-surface-600-300-token">Click on a node to view details</p>',1),Ea=p('<div class="app-card p-8 text-center"><p>Loading nodes...</p></div>'),wa=p('<div class="app-card p-8 text-center text-error-500"><p> </p></div>'),Na=p('<div class="text-surface-600-300-token py-8 text-center"><p> </p></div>'),ka=p('<tr><td> </td><td style="width: 200px;"><button type="button" class="btn preset-filled btn-sm">View &rarr;</button></td></tr>'),Sa=p('<div class="flex items-center justify-center gap-2 mt-4"><button type="button" class="btn btn preset-filled btn-sm"><!></button> <span class="text-sm"> </span> <button type="button" class="btn btn preset-filled btn-sm"><!></button></div>'),Aa=p('<div class="table-container"><table class="app-table"><thead><tr><th>Name</th><th style="width: 200px;">Actions</th></tr></thead><tbody></tbody></table></div> <!>',1),La=p('<div class="app-card"><div class="p-6"><div class="mb-4 flex items-center justify-between"><h1 class="h4">Nodes</h1> <div class="flex-1 max-w-md ml-4"><input type="text" class="app-input" placeholder="Search nodes by name or ID..."/></div></div> <!></div></div>'),Ca=p('<div class="grid grid-cols-1 gap-6 lg:grid-cols-3"><div class="lg:col-span-2"><div class="card p-4"><div style="height: 600px; overflow: hidden;"></div></div> <div class="text-surface-600-300-token mt-2 text-sm"><p> </p> <p class="mt-1 text-xs">Hover over nodes to highlight connections. Click to view details.</p></div></div> <div class="app-card lg:col-span-1"><div class="sticky top-6 space-y-4 card p-6" style="max-height: 650px; overflow-y: auto;"><!></div></div></div> <!>',1),Ta=p('<div class="space-y-6 p-6"><!> <!> <!></div>');function Xa(E,P){nt(P,!1);const g=()=>Qt(Xt,"$page",V),[V,B]=qt(),l=v(),z=v(),w=v(),ne=v(),Ae=v(),Re=v(),ue=v(),le=5;$e.registerLanguage("go",va);let O=v(),b=v(null),ge=v(!0),ce=v(""),c=v(null),J=v(null),Le=v(null);const C=new Set,T=new Set;let Ge=null;const he=new Set,_e=new Set;let N=v(new Map),I=v(1),H=v(""),me=v([]),Ce=v(!0),Te=v("");const{displayFlash:Ia}=tt("flashMessage"),{displayFlashErrorMessage:ct}=tt("flashErrorMessage");let Z=v(),Ie=v(!1);Mt(async()=>{await Promise.all([Ke(),vt(),dt()]),n(Ie,!0)});async function dt(){try{n(Le,await ta(e(Z)))}catch(t){const r=t instanceof Error?t.message:"Failed to fetch service details";ct(r),n(ce,r),console.error("Error fetching service:",t)}}async function vt(){try{n(me,await aa(e(Z))),console.log("Loaded nodes data:",e(me)),n(Ce,!1)}catch(t){n(Te,t instanceof Error?t.message:"Failed to load nodes"),n(Ce,!1),console.error("Error loading nodes:",t)}}function Be(t,r,y){t&&(r.add(t),Array.isArray(t.neighbors)&&t.neighbors.forEach(F=>r.add(F)),Array.isArray(t.links)&&t.links.forEach(F=>y.add(F)))}function ze(t){he.clear(),_e.clear(),n(c,t||null),Be(e(c),he,_e)}function Me(t){const r=e(N).get(t);r&&(ze(r),n(c,r),C.clear(),T.clear(),Be(r,C,T),e(O)&&e(O).scrollIntoView({behavior:"smooth",block:"center"}),e(J)&&r.x!==void 0&&r.y!==void 0&&(e(J).centerAt(r.x,r.y,1e3),e(J).zoom(3,1e3)))}function He(t){const r=new URL(window.location.href);r.searchParams.set("focus",t),ot(r.pathname+r.search)}function ft(t){return!t||!t.links?[]:t.links.map(r=>{const y=typeof r.source=="object"?r.source:e(N).get(r.source),F=typeof r.target=="object"?r.target:e(N).get(r.target);return y===t?F:null}).filter(Boolean)}async function Ke(){try{n(b,await ra(e(Z),e(l))),console.log("Loaded graph data:",e(b)),n(N,new Map(e(b).nodes.map(t=>[t.id,t]))),e(b).nodes.forEach(t=>{t.neighbors=[],t.links=[]}),e(b).links.forEach(t=>{const r=typeof t.source=="object"?t.source:e(N).get(t.source),y=typeof t.target=="object"?t.target:e(N).get(t.target);!r||!y||(r.neighbors.push(y),y.neighbors.push(r),(r.links||(r.links=[])).push(t),(y.links||(y.links=[])).push(t))}),n(ge,!1),await new Promise(t=>setTimeout(t,100)),e(O)&&await gt()}catch(t){n(ce,t instanceof Error?t.message:"Failed to load graph"),n(ge,!1),console.error("Error loading graph:",t)}}function Ue(){return`callgraph-positions-${e(Z)}-${e(l)||"root"}`}function pt(){if(!e(J)||!e(b))return;const t={};e(b).nodes.forEach(r=>{r.x!==void 0&&r.y!==void 0&&(t[r.id]={x:r.x,y:r.y})});try{localStorage.setItem(Ue(),JSON.stringify(t)),console.log(`Saved positions for ${Object.keys(t).length} nodes`)}catch(r){console.error("Failed to save node positions:",r)}}function ut(){try{const t=localStorage.getItem(Ue());if(t){const r=JSON.parse(t);return console.log(`Loaded positions for ${Object.keys(r).length} nodes`),r}}catch(t){console.error("Failed to load node positions:",t)}return null}async function gt(){try{const r=(await Tt(()=>import("../chunks/iN_cEwNE.js"),[],import.meta.url)).default;e(O)&&Ht(O,e(O).innerHTML="");const y=ut();let F=!1;y&&e(b).nodes.forEach(a=>{const i=y[a.id];i&&(a.x=i.x,a.y=i.y,a.fx=i.x,a.fy=i.y,F=!0)}),n(J,new r(e(O))),e(J).graphData(e(b)).nodeId("id").nodeVal("val").nodeLabel("id").linkSource("source").linkTarget("target").width(e(O).clientWidth).height(600).onNodeHover(a=>{C.clear(),T.clear(),a&&(C.add(a),a.neighbors.forEach(i=>C.add(i)),a.links.forEach(i=>T.add(i))),he.forEach(i=>C.add(i)),_e.forEach(i=>T.add(i)),Ge=a||null}).onLinkHover(a=>{if(C.clear(),T.clear(),a){T.add(a);const i=typeof a.source=="object"?a.source:e(N).get(a.source),k=typeof a.target=="object"?a.target:e(N).get(a.target);i&&C.add(i),k&&C.add(k)}he.forEach(i=>C.add(i)),_e.forEach(i=>T.add(i))}).onNodeClick(a=>{ze(a),n(c,a)}).autoPauseRedraw(!1).linkWidth(a=>T.has(a)?2:1).linkColor(a=>T.has(a)?"#fff":"#aaaaaa").linkDirectionalArrowLength(a=>T.has(a)?6:0).linkDirectionalArrowRelPos(1).nodeColor(a=>{if(C.has(a)){const i=Ge||e(c);if(a===i)return"white";let k=!1,Y=!1;if(Array.isArray(a.links)&&i)for(const S of a.links){const de=typeof S.source=="object"?S.source:e(N).get(S.source),re=typeof S.target=="object"?S.target:e(N).get(S.target);if(de===a&&re===i){k=!0;break}if(de===i&&re===a){Y=!0;break}}return k?"#FB9A99":Y?"#337AB8":"white"}if(a&&a.node_type==="interface")return"#39847D";if(a&&a.external==="true")return"#A6CEE3";if(a&&a.external==="false")return"#4DB6AC"}).nodeCanvasObjectMode(()=>"after").nodeCanvasObject((a,i,k)=>{const Y=a.name||"unknown",S=12/k;i.font=S+"px Sans-Serif",i.textAlign="center",i.textBaseline="top",i.fillStyle="#fff",i.fillText(Y,a.x,a.y+8)}),console.log("Graph initialized successfully"),F?console.log("Applied saved positions. Graph should render instantly."):(console.log("No saved positions found. Will save positions after 20 seconds..."),setTimeout(()=>{pt()},2e4));const be=g().url.searchParams.get("focus");be&&setTimeout(()=>{Me(be)},500)}catch(t){n(ce,t instanceof Error?t.message:"Failed to initialize graph"),console.error("Error initializing graph:",t)}}L(()=>g(),()=>{n(Z,g().params.id)}),L(()=>g(),()=>{n(l,g().url.searchParams.get("root_node_id"))}),L(()=>e(me),()=>{n(z,e(me))}),L(()=>(e(H),e(z)),()=>{n(w,e(H)?e(z).filter(t=>t.name?.toLowerCase().includes(e(H).toLowerCase())||t.id?.toLowerCase().includes(e(H).toLowerCase())):e(z))}),L(()=>e(H),()=>{e(H),n(I,1)}),L(()=>e(I),()=>{n(ne,(e(I)-1)*le)}),L(()=>e(ne),()=>{n(Ae,e(ne)+le)}),L(()=>(e(w),e(ne),e(Ae)),()=>{n(Re,e(w).slice(e(ne),e(Ae)))}),L(()=>(e(Ie),e(l)),()=>{e(Ie)&&(e(l),n(c,null),n(ge,!0),Ke())}),L(()=>e(c),()=>{n(ue,ft(e(c)))}),L(()=>(e(c),$e),()=>{e(c)&&setTimeout(()=>{const t=document.getElementById("node-code");t&&$e.highlightElement(t)},10)}),L(()=>(g(),e(J),e(N)),()=>{const t=g().url.searchParams.get("focus");t&&e(J)&&e(N).size>0&&Me(t)}),Bt(),Vt();var Pe=Ta();ca("xu7n8e",t=>{var r=fa();d(t,r)});var We=o(Pe);{let t=zt(()=>(e(Le),m(()=>e(Le)?.name||"")));Zt(We,{get serviceName(){return e(t)}})}var Ve=f(We,2);ea(Ve,{get serviceId(){return e(Z)}});var ht=f(Ve,2);{var _t=t=>{var r=pa();d(t,r)},mt=t=>{var r=ke(),y=ae(r);{var F=a=>{var i=ua(),k=o(i),Y=o(k);s(k),s(i),W(()=>R(Y,`Error: ${e(ce)??""}`)),d(a,i)},be=a=>{var i=ke(),k=ae(i);{var Y=S=>{var de=Ca(),re=ae(de),Oe=o(re),Fe=o(Oe),bt=o(Fe);It(bt,h=>n(O,h),()=>e(O)),s(Fe);var Je=f(Fe,2),Ye=o(Je),yt=o(Ye);s(Ye),at(2),s(Je),s(Oe);var qe=f(Oe,2),Qe=o(qe),xt=o(Qe);{var Et=h=>{var K=ya(),ve=ae(K),De=o(ve);s(ve);var ye=f(ve,2),D=o(ye),j=o(D),ee=f(j,2);s(D);var U=f(D,2),fe=f(o(U),2),xe=o(fe,!0);s(fe),s(U);var Ee=f(U,2);{var je=_=>{var A=ha(),se=f(o(A),2),X=o(se);la(X,()=>(e(c),m(()=>e(c).id)),M=>{var u=ga(),x=o(u),te=o(x,!0);s(x),s(u),W(()=>R(te,(e(c),m(()=>e(c).code)))),d(M,u)}),s(se),s(A),d(_,A)};G(Ee,_=>{e(c),m(()=>e(c).code)&&_(je)})}var we=f(Ee,2),$=f(o(we),2);{var q=_=>{var A=ma();rt(A,5,()=>e(ue),st,(se,X)=>{var M=_a(),u=o(M),x=o(u,!0);s(u),s(M),W(()=>R(x,(e(X),m(()=>e(X).name||e(X).id)))),ie("click",u,()=>He(e(X).id)),d(se,M)}),s(A),d(_,A)},Q=_=>{var A=ba();d(_,A)};G($,_=>{e(ue),m(()=>e(ue).length>0)?_(q):_(Q,!1)})}s(we),s(ye),W(()=>{R(De,`Node: ${e(c),m(()=>e(c).name)??""}`),R(xe,(e(c),m(()=>e(c).id)))}),ie("click",j,()=>Me(e(c).id)),ie("click",ee,()=>ot(`/services/${e(Z)}/callgraph?root_node_id=${encodeURIComponent(e(c).id)}`)),d(h,K)},wt=h=>{var K=xa();at(2),d(h,K)};G(xt,h=>{e(c)?h(Et):h(wt,!1)})}s(Qe),s(qe),s(re);var Nt=f(re,2);{var kt=h=>{var K=Ea();d(h,K)},St=h=>{var K=ke(),ve=ae(K);{var De=D=>{var j=wa(),ee=o(j),U=o(ee);s(ee),s(j),W(()=>R(U,`Error: ${e(Te)??""}`)),d(D,j)},ye=D=>{var j=La(),ee=o(j),U=o(ee),fe=f(o(U),2),xe=o(fe);Ut(xe),s(fe),s(U);var Ee=f(U,2);{var je=$=>{var q=Na(),Q=o(q),_=o(Q);s(Q),s(q),W(()=>R(_,`No nodes found${e(H)?" matching your search":""}.`)),d($,q)},we=$=>{var q=Aa(),Q=ae(q),_=o(Q),A=f(o(_));rt(A,5,()=>e(Re),st,(M,u)=>{var x=ka(),te=o(x),pe=o(te,!0);s(te);var Ne=f(te),oe=o(Ne);s(Ne),s(x),W(()=>R(pe,(e(u),m(()=>e(u).name||e(u).id)))),ie("click",oe,()=>He(e(u).id)),d(M,x)}),s(A),s(_),s(Q);var se=f(Q,2);{var X=M=>{var u=Sa(),x=o(u),te=o(x);da(te,{class:"size-4"}),s(x);var pe=f(x,2),Ne=o(pe);s(pe);var oe=f(pe,2),At=o(oe);ia(At,{class:"size-4"}),s(oe),s(u),W((Lt,Ct)=>{x.disabled=e(I)===1,R(Ne,`Page ${e(I)??""} of ${Lt??""}`),oe.disabled=Ct},[()=>(e(w),m(()=>Math.ceil(e(w).length/le))),()=>(e(I),e(w),m(()=>e(I)>=Math.ceil(e(w).length/le)))]),ie("click",x,()=>n(I,e(I)-1)),ie("click",oe,()=>n(I,e(I)+1)),d(M,u)};G(se,M=>{e(w),m(()=>e(w).length>le)&&M(X)})}d($,q)};G(Ee,$=>{e(w),m(()=>e(w).length===0)?$(je):$(we,!1)})}s(ee),s(j),Wt(xe,()=>e(H),$=>n(H,$)),d(D,j)};G(ve,D=>{e(Te)?D(De):D(ye,!1)},!0)}d(h,K)};G(Nt,h=>{e(Ce)?h(kt):h(St,!1)})}W(()=>R(yt,`Nodes: ${e(b),m(()=>e(b).nodes.length)??""} | Links: ${e(b),m(()=>e(b).links.length)??""}`)),d(S,de)};G(k,S=>{e(b)&&S(Y)},!0)}d(a,i)};G(y,a=>{e(ce)?a(F):a(be,!1)},!0)}d(t,r)};G(ht,t=>{e(ge)?t(_t):t(mt,!1)})}s(Pe),d(E,Pe),lt(),B()}export{Xa as component};
