import{f as p,a as f,c as Ae,e as q}from"../chunks/DZs8rR8k.js";import"../chunks/D2htM9l8.js";import{o as lt}from"../chunks/CSfjm-6H.js";import{p as vt,v as Re,l as xe,c as dt,d as ft,g as e,m as A,f as g,e as a,q as _t,s as n,r as t,u as s,j as ae,k as b,o as pt}from"../chunks/B4RuN_dZ.js";import{s as _}from"../chunks/Bwak9JMZ.js";import{i as x}from"../chunks/B2LozDeQ.js";import{e as Me,i as Ce}from"../chunks/dk5Fz5Mq.js";import{r as Fe,a as D,s as ke,c as ut,b as Ie}from"../chunks/C6Um85Qa.js";import{i as mt}from"../chunks/D_xYtrhe.js";import{s as ht,a as gt}from"../chunks/h4F42on8.js";import"../chunks/-0XD8d-T.js";import{p as bt}from"../chunks/BDtijp9S.js";import{S as yt,a as xt}from"../chunks/DtVy8I9e.js";import{f as kt,g as je}from"../chunks/D6hLoUej.js";import{r as wt,b as St,d as zt}from"../chunks/Bq6M2nPi.js";var Et=p('<div class="p-8 text-center"><p>Loading service details...</p></div>'),$t=p('<div class="p-8 text-center text-error-500"><p> </p></div>'),Ht=p('<div class="space-y-4 p-6"><div class="grid grid-cols-1 gap-6 md:grid-cols-2"><div><h3 class="text-surface-600-300-token mb-1 text-sm font-semibold">Status</h3> <span> </span></div> <div><h3 class="text-surface-600-300-token mb-1 text-sm font-semibold">Entrypoint</h3> <p class="font-mono text-lg"> </p></div> <div><h3 class="text-surface-600-300-token mb-1 text-sm font-semibold">Git Repository URL</h3> <a target="_blank" rel="noopener noreferrer" class="anchor break-all hover:underline"> </a></div> <div><h3 class="text-surface-600-300-token mb-1 text-sm font-semibold">Created At</h3> <p class="text-lg"> </p></div> <div><h3 class="text-surface-600-300-token mb-1 text-sm font-semibold">Git Organization URL</h3> <a target="_blank" rel="noopener noreferrer" class="anchor break-all hover:underline"> </a></div> <div class="md:col-span-2"><h3 class="text-surface-600-300-token mb-1 text-sm font-semibold">Git Commit</h3> <p class="font-mono text-lg"> </p></div></div></div>'),At=p('<a class="anchor hover:underline"> </a>'),Rt=p('<span class="text-surface-500">N/A</span>'),Mt=p('<a class="anchor hover:underline"> </a>'),Ct=p('<span class="text-surface-500"> </span>'),Ft=p('<button type="button" class="btn inline-flex w-28 preset-filled btn-sm"><span> </span> <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></button>'),It=p('<span class="text-surface-500">0</span>'),jt=p('<a class="anchor hover:underline"> </a>'),Nt=p('<span class="text-surface-500"> </span>'),Tt=p("- <!>",1),Ut=p('<li><span class="font-semibold"> </span> <!></li>'),Lt=p('<tr><td colspan="6" class="bg-surface-50-900-token"><div class="p-4"><ul class="list-inside list-disc space-y-2"></ul></div></td></tr>'),Ot=p('<tr><td> </td><td><span class="font-mono"> </span></td><td class="font-mono text-sm"><!></td><td class="font-mono text-sm"><!></td><td><!></td><td><input type="checkbox" class="checkbox"/></td></tr> <!>',1),qt=p('<div class="app-card"><div class="p-6"><div class="mb-4 flex items-center justify-between"><h1 class="h4">Handlers</h1> <div class="flex gap-2"><button type="button" class="btn preset-filled-tertiary-500 btn-sm">Re-analyze Service</button> <button type="button" class="btn preset-filled-tertiary-500 btn-sm">Re-analyze Handler</button> <button type="button" class="btn preset-tonal-error btn-sm">Delete</button></div></div> <div class="table-container"><table class="app-table"><thead><tr><th>Type</th><th>Endpoint</th><th>Source Function</th><th>Function</th><th>Outputs</th><th><input type="checkbox" class="checkbox"/></th></tr></thead><tbody></tbody></table></div></div></div>'),Dt=p('<div class="space-y-6 p-6"><!> <!> <div class="app-card"><!></div> <!></div>');function sa(Ne,Te){vt(Te,!1);const G=()=>gt(bt,"$page",Ue),[Ue,Le]=ht(),P=A(),re=A();let o=A(null),we=A(!0),se=A(""),k=A(new Set),c=A(new Set);const{displayFlash:oe}=Re("flashMessage"),{displayFlashErrorMessage:Q}=Re("flashErrorMessage");let w=A();lt(async()=>{await W(),g(we,!1),e(P)&&setTimeout(()=>{const i=document.querySelector(`tr[data-handler-id="${e(P)}"]`);i&&i.scrollIntoView({behavior:"smooth",block:"center"})},100)});async function W(){try{g(o,await kt(e(w)))}catch(i){const d=i instanceof Error?i.message:"Failed to fetch service details";Q(d),g(se,d),console.error("Error fetching service:",i)}}function Oe(i){return i?new Date(i).toLocaleString():"N/A"}function qe(i){e(k).has(i)?e(k).delete(i):e(k).add(i),g(k,e(k))}function De(){e(re)?e(c).clear():e(o)?.handlers?.forEach(i=>{e(c).add(i.id)}),g(c,e(c))}async function Ge(){if(e(c).size===0||!confirm("Are you sure you want to delete the selected handlers?"))return;const d=Array.from(e(c));try{await zt(e(w),d),e(c).clear(),g(c,e(c)),oe("Handlers deleted"),await W()}catch(u){const S=u instanceof Error?u.message:"Failed to delete handlers";Q(S),console.error("Error deleting handlers:",u)}}async function Pe(){if(e(c).size===0||!confirm("Are you sure you want to re-analyze the selected handlers? This will delete all existing outputs for the handlers and re-analyze them."))return;const d=Array.from(e(c));try{await St(e(w),d),e(c).clear(),g(c,e(c)),oe("Re-analysis job started successfully"),await W()}catch(u){const S=u instanceof Error?u.message:"Failed to start re-analysis";Q(S),console.error("Error starting re-analysis:",u)}}async function Be(){if(confirm("Are you sure you want to re-analyze this service? This will delete all of the service's handlers and outputs, then re-analyze it and create new ones."))try{await wt(e(w)),oe("Service re-analysis job started successfully"),await W()}catch(d){const u=d instanceof Error?d.message:"Failed to start service re-analysis";Q(u),console.error("Error starting service re-analysis:",d)}}xe(()=>G(),()=>{g(w,G().params.id)}),xe(()=>G(),()=>{g(P,G().url.searchParams.get("highlight_handler_id")?parseInt(G().url.searchParams.get("highlight_handler_id")):null)}),xe(()=>(e(o),e(c)),()=>{g(re,e(o)?.handlers&&e(o).handlers.length>0&&e(o).handlers.every(i=>e(c).has(i.id)))}),dt(),mt();var ie=Dt(),Se=a(ie);{let i=_t(()=>(e(o),s(()=>e(o)?.name||"")));yt(Se,{get serviceName(){return e(i)}})}var ze=n(Se,2);xt(ze,{get serviceId(){return e(w)}});var ne=n(ze,2),Ve=a(ne);{var Je=i=>{var d=Et();f(i,d)},Ke=i=>{var d=Ae(),u=ae(d);{var S=z=>{var y=$t(),R=a(y),N=a(R);t(R),t(y),b(()=>_(N,`Error: ${e(se)??""}`)),f(z,y)},X=z=>{var y=Ae(),R=ae(y);{var N=T=>{var M=Ht(),B=a(M),U=a(B),C=n(a(U),2),Y=a(C,!0);t(C),t(U);var V=n(U,2),r=n(a(V),2),Z=a(r);t(r),t(V);var E=n(V,2),F=n(a(E),2),ce=a(F,!0);t(F),t(E);var I=n(E,2),J=n(a(I),2),le=a(J,!0);t(J),t(I);var j=n(I,2),K=n(a(j),2),ve=a(K,!0);t(K),t(j);var ee=n(j,2),L=n(a(ee),2),de=a(L,!0);t(L),t(ee),t(B),t(M),b((fe,_e)=>{ke(C,1,`badge ${fe??""}`),_(Y,(e(o),s(()=>e(o).status))),_(Z,`${e(o),s(()=>e(o).entrypoint_path)??""}:${e(o),s(()=>e(o).entrypoint_function)??""}`),D(F,"href",(e(o),s(()=>e(o).git_repo_url))),_(ce,(e(o),s(()=>e(o).git_repo_url))),_(le,_e),D(K,"href",(e(o),s(()=>e(o).git_org_url))),_(ve,(e(o),s(()=>e(o).git_org_url))),_(de,(e(o),s(()=>e(o).git_commit||"N/A")))},[()=>(pt(je),e(o),s(()=>je(e(o).status))),()=>(e(o),s(()=>Oe(e(o).created_at)))]),f(T,M)};x(R,T=>{e(o)&&T(N)},!0)}f(z,y)};x(u,z=>{e(se)?z(S):z(X,!1)},!0)}f(i,d)};x(Ve,i=>{e(we)?i(Je):i(Ke,!1)})}t(ne);var Qe=n(ne,2);{var We=i=>{var d=qt(),u=a(d),S=a(u),X=n(a(S),2),z=a(X),y=n(z,2),R=n(y,2);t(X),t(S);var N=n(S,2),T=a(N),M=a(T),B=a(M),U=n(a(B),5),C=a(U);Fe(C),t(U),t(B),t(M);var Y=n(M);Me(Y,5,()=>(e(o),s(()=>e(o).handlers)),Ce,(V,r)=>{var Z=Ot(),E=ae(Z),F=a(E),ce=a(F,!0);t(F);var I=n(F),J=a(I),le=a(J);t(J),t(I);var j=n(I),K=a(j);{var ve=l=>{var v=At(),h=a(v,!0);t(v),b($=>{D(v,"href",`/services/${e(w)??""}/callgraph?focus=${$??""}`),_(h,(e(r),s(()=>e(r).source_function_name)))},[()=>(e(r),s(()=>encodeURIComponent(e(r).source_function_id)))]),f(l,v)},ee=l=>{var v=Rt();f(l,v)};x(K,l=>{e(r),s(()=>e(r).source_function_id)?l(ve):l(ee,!1)})}t(j);var L=n(j),de=a(L);{var fe=l=>{var v=Mt(),h=a(v,!0);t(v),b($=>{D(v,"href",`/services/${e(w)??""}/callgraph?focus=${$??""}`),_(h,(e(r),s(()=>e(r).function_name)))},[()=>(e(r),s(()=>encodeURIComponent(e(r).function_id)))]),f(l,v)},_e=l=>{var v=Ct(),h=a(v,!0);t(v),b(()=>_(h,(e(r),s(()=>e(r).function_name)))),f(l,v)};x(de,l=>{e(r),s(()=>e(r).function_id)?l(fe):l(_e,!1)})}t(L);var pe=n(L),Xe=a(pe);{var Ye=l=>{var v=Ft(),h=a(v),$=a(h);t(h);var te=n(h,2);t(v),b(me=>{_($,`${e(r),s(()=>e(r).outputs.length)??""} Outputs`),ke(te,0,`h-4 w-4 transition-transform ${me??""}`)},[()=>(e(k),e(r),s(()=>e(k).has(e(r).id)?"rotate-180":""))]),q("click",v,()=>qe(e(r).id)),f(l,v)},Ze=l=>{var v=It();f(l,v)};x(Xe,l=>{e(r),s(()=>e(r).outputs&&e(r).outputs.length>0)?l(Ye):l(Ze,!1)})}t(pe);var Ee=n(pe),ue=a(Ee);Fe(ue),t(Ee),t(E);var et=n(E,2);{var tt=l=>{var v=Lt(),h=a(v),$=a(h),te=a($);Me(te,5,()=>(e(r),s(()=>e(r).outputs)),Ce,(me,m)=>{var he=Ut(),ge=a(he),at=a(ge);t(ge);var $e=n(ge),rt=n($e);{var st=be=>{var He=Tt(),ot=n(ae(He));{var it=O=>{var H=jt(),ye=a(H,!0);t(H),b(ct=>{D(H,"href",`/services/${e(w)??""}/callgraph?focus=${ct??""}`),_(ye,(e(m),s(()=>e(m).function_name)))},[()=>(e(m),s(()=>encodeURIComponent(e(m).function_id)))]),f(O,H)},nt=O=>{var H=Nt(),ye=a(H,!0);t(H),b(()=>_(ye,(e(m),s(()=>e(m).function_name)))),f(O,H)};x(ot,O=>{e(m),s(()=>e(m).function_id)?O(it):O(nt,!1)})}f(be,He)};x(rt,be=>{e(m),s(()=>e(m).function_name)&&be(st)})}t(he),b(()=>{_(at,`${e(m),s(()=>e(m).type)??""}:`),_($e,` ${e(m),s(()=>e(m).label)??""} `)}),f(me,he)}),t(te),t($),t(h),t(v),f(l,v)};x(et,l=>{e(k),e(r),s(()=>e(k).has(e(r).id)&&e(r).outputs&&e(r).outputs.length>0)&&l(tt)})}b(l=>{D(E,"data-handler-id",(e(r),s(()=>e(r).id))),ke(E,1,ut((e(P),e(r),s(()=>e(P)===e(r).id?"bg-primary-500/20 ring-2 ring-primary-500":"")))),_(ce,(e(r),s(()=>e(r).type||"N/A"))),_(le,`${e(r),s(()=>e(r).method)??""}
											${e(r),s(()=>e(r).path)??""}`),Ie(ue,l)},[()=>(e(c),e(r),s(()=>e(c).has(e(r).id)))]),q("change",ue,()=>{e(c).has(e(r).id)?e(c).delete(e(r).id):e(c).add(e(r).id),g(c,e(c))}),f(V,Z)}),t(Y),t(T),t(N),t(u),t(d),b(()=>{y.disabled=(e(c),s(()=>e(c).size===0)),R.disabled=(e(c),s(()=>e(c).size===0)),Ie(C,e(re))}),q("click",z,Be),q("click",y,Pe),q("click",R,Ge),q("change",C,De),f(i,d)};x(Qe,i=>{e(o),s(()=>e(o)&&e(o).handlers&&e(o).handlers.length>0)&&i(We)})}t(ie),f(Ne,ie),ft(),Le()}export{sa as component};
